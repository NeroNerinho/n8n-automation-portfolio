# ğŸ¤– DocumentaÃ§Ã£o Completa do Workflow n8n

> **Workflow**: Painel AprovaÃ§Ã£o  
> **Arquivo**: `n8n_workflow_FINAL_V6.json`  
> **VersÃ£o**: 6.0 (Fevereiro 2026)

---

## ğŸ§  Entendendo n8n (ExplicaÃ§Ã£o Feynman)

### Imagine Que...

VocÃª contrata um **assistente robÃ´ super eficiente** para seu escritÃ³rio. Este robÃ´:

1. **Fica 24/7 acordado** esperando tarefas
2. **Atende o telefone** quando alguÃ©m liga (webhook)
3. **Pergunta**: "Qual tipo de serviÃ§o vocÃª precisa?" (action)
4. **Executa** a tarefa automaticamente
5. **Responde** com o resultado

**n8n Ã© esse robÃ´ digital.** Cada "nÃ³" no workflow Ã© uma tarefa que o robÃ´ sabe fazer.

---

## ğŸ—ºï¸ Mapa Visual do Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ENTRADA DO SISTEMA                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚   â”‚ Webhook OPTIONS  â”‚â”€â”€â”€â”€â–¶â”‚  Respond CORS    â”‚  (Preflight para browsers) â”‚
â”‚   â”‚     (CORS)       â”‚     â”‚      "OK"        â”‚                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  Webhook POST    â”‚â”€â”€â”€â”€â–¶â”‚  Parse Request   â”‚â”€â”€â”€â”€â–¶â”‚ Router de AÃ§Ãµes â”‚    â”‚
â”‚   â”‚ /painel-aprovacaoâ”‚     â”‚ Extrai: action,  â”‚     â”‚    (Switch)     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ query, body      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                         â–¼                             â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
     â”‚  â”‚   login    â”‚ get_stats  â”‚get_pending â”‚  approve   â”‚   reject   â”‚health_checkâ”‚      â”‚
     â”‚  â”‚            â”‚            â”‚            â”‚            â”‚            â”‚            â”‚      â”‚
     â”‚  â”‚ Validar    â”‚ Contar:    â”‚ SELECT *   â”‚ UPDATE:    â”‚ Fluxo      â”‚ Status dos â”‚      â”‚
     â”‚  â”‚ email/     â”‚ total,     â”‚ WHERE      â”‚ status =   â”‚ complexo   â”‚ serviÃ§os   â”‚      â”‚
     â”‚  â”‚ senha      â”‚ pendentes, â”‚ status =   â”‚ APROVADO   â”‚ (ver       â”‚ BigQuery,  â”‚      â”‚
     â”‚  â”‚            â”‚ aprovados, â”‚ PENDENTE   â”‚            â”‚ abaixo)    â”‚ Drive,     â”‚      â”‚
     â”‚  â”‚            â”‚ reprovados â”‚            â”‚            â”‚            â”‚ SMTP       â”‚      â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
     â”‚        â”‚            â”‚            â”‚            â”‚            â”‚            â”‚              â”‚
     â”‚        â–¼            â–¼            â–¼            â–¼            â–¼            â–¼              â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
     â”‚  â”‚                        RESPOND TO WEBHOOK (JSON)                             â”‚     â”‚
     â”‚  â”‚        Retorna resultado para o frontend em formato padronizado               â”‚     â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
     â”‚                                                                                       â”‚
     â”‚                               SAÃDA DO SISTEMA                                        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ Detalhamento das Actions

### 1. `login` â€” AutenticaÃ§Ã£o de UsuÃ¡rio

**O que faz**: Valida email e senha, retorna dados do usuÃ¡rio se correto.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Recebe    â”‚â”€â”€â”€â”€â–¶â”‚   Handle Login    â”‚â”€â”€â”€â”€â–¶â”‚ Respond Login  â”‚
â”‚ email/pwd  â”‚     â”‚ Valida credenciaisâ”‚     â”‚ { success, user}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Payload de Entrada**:
```json
{
  "action": "login",
  "email": "usuario@empresa.com",
  "password": "senha123"
}
```

**Resposta de Sucesso**:
```json
{
  "success": true,
  "user": {
    "name": "Nome do UsuÃ¡rio",
    "email": "usuario@empresa.com",
    "role": "approver",
    "avatar": "https://..."
  }
}
```

---

### 2. `get_stats` â€” Dashboard de EstatÃ­sticas

**O que faz**: Conta total de checkings por status.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ action:    â”‚â”€â”€â”€â–¶â”‚ BigQuery - Get Statsâ”‚â”€â”€â”€â”€â–¶â”‚ Respond Stats   â”‚
â”‚ get_stats  â”‚     â”‚ COUNT(*) por status â”‚     â”‚ { stats: {...}} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Query SQL Executada**:
```sql
SELECT
  COUNT(*) as total,
  COUNTIF(approval_status = 'PENDENTE') as pending,
  COUNTIF(approval_status = 'APROVADO') as approved,
  COUNTIF(approval_status = 'REPROVADO') as rejected
FROM `projeto.dataset.checking_logs`
```

**Resposta**:
```json
{
  "total": 1248,
  "pending": 12,
  "approved": 980,
  "rejected": 256
}
```

---

### 3. `get_pending` â€” Listar Checkings Pendentes

**O que faz**: Retorna todos os checkings aguardando aprovaÃ§Ã£o.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ action:    â”‚â”€â”€â”€â”€â–¶â”‚ BigQuery - Get       â”‚â”€â”€â”€â”€â–¶â”‚ Format Pending â”‚â”€â”€â”€â”€â–¶â”‚ Respond Pendingâ”‚
â”‚ get_pendingâ”‚     â”‚ Pending              â”‚     â”‚ Response       â”‚     â”‚ { checkings: }â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ WHERE status=PENDENTEâ”‚     â”‚ [array]        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Resposta**:
```json
{
  "checkings": [
    {
      "id": "2026-02-04T10:30:00.000Z",
      "n_pi": "PI-12345",
      "cliente": "Cliente ABC",
      "veiculo": "TV Globo",
      "fornecedor": "Fornecedor XYZ",
      "email": "fornecedor@email.com",
      "webViewLink": "https://drive.google.com/drive/folders/...",
      "totalArquivos": 5,
      "approval_status": "PENDENTE",
      "rejection_count": 0,
      "data_envio": "04/02/2026 10:30"
    }
  ]
}
```

---

### 4. `approve` â€” Aprovar Checking

**O que faz**: Marca um checking como APROVADO no banco de dados.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ action:    â”‚â”€â”€â”€â”€â–¶â”‚ BigQuery - Approve   â”‚â”€â”€â”€â”€â–¶â”‚ Respond Approve â”‚
â”‚ approve    â”‚     â”‚ UPDATE status =      â”‚     â”‚ { success: true }â”‚
â”‚ + id       â”‚     â”‚ 'APROVADO'           â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Query SQL Executada**:
```sql
UPDATE `projeto.dataset.checking_logs`
SET
  approval_status = 'APROVADO',
  approval_date = CURRENT_TIMESTAMP(),
  approval_user = 'email@empresa.com'
WHERE id = '2026-02-04T10:30:00.000Z'
```

---

### 5. `reject` â€” Reprovar Checking (Fluxo Mais Complexo)

Este Ã© o fluxo mais sofisticado do sistema. Envolve:
- Consulta ao BigQuery
- ManipulaÃ§Ã£o de pastas no Google Drive
- CriaÃ§Ã£o de arquivos de histÃ³rico
- Upload opcional de PDF
- AtualizaÃ§Ã£o do banco de dados
- Envio de email ao fornecedor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  FLUXO DE REPROVAÃ‡ÃƒO                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                     â”‚
â”‚  â”‚ action: reject  â”‚                                                                     â”‚
â”‚  â”‚ + id            â”‚                                                                     â”‚
â”‚  â”‚ + reason        â”‚                                                                     â”‚
â”‚  â”‚ + pdf (opcional)â”‚                                                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                     â”‚
â”‚           â”‚                                                                              â”‚
â”‚           â–¼                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚ BigQuery - Get Checking Dataâ”‚  Busca dados completos do checking                     â”‚
â”‚  â”‚ SELECT * WHERE id = X       â”‚                                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚               â”‚                                                                          â”‚
â”‚               â–¼                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚ Drive - Search Historico Folder â”‚  Procura pasta "HistÃ³rico do fornecedor"          â”‚
â”‚  â”‚ (dentro da pasta do checking)   â”‚                                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚               â”‚                                                                          â”‚
â”‚               â–¼                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                 â”‚
â”‚  â”‚ Check Historico     â”‚                                                                 â”‚
â”‚  â”‚ Exists? (IF node)   â”‚                                                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                 â”‚
â”‚             â”‚                                                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                                                    â”‚
â”‚     â”‚               â”‚                                                                    â”‚
â”‚     â–¼               â–¼                                                                    â”‚
â”‚ [Existe]      [NÃ£o Existe]                                                               â”‚
â”‚     â”‚               â”‚                                                                    â”‚
â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚     â”‚    â”‚ Drive - Create Historico     â”‚                                                â”‚
â”‚     â”‚    â”‚ Folder                       â”‚                                                â”‚
â”‚     â”‚    â”‚ "HistÃ³rico do fornecedor"    â”‚                                                â”‚
â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚     â”‚               â”‚                                                                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                                    â”‚
â”‚             â”‚                                                                            â”‚
â”‚             â–¼                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                             â”‚
â”‚  â”‚ Set Historico ID        â”‚  Armazena o ID da pasta para uso posterior                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                             â”‚
â”‚               â”‚                                                                          â”‚
â”‚               â–¼                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚ Create Observacao File      â”‚  Gera arquivo TXT com:                                 â”‚
â”‚  â”‚ (Code Node)                 â”‚  - PI, Cliente, Fornecedor                             â”‚
â”‚  â”‚                             â”‚  - Data/hora                                            â”‚
â”‚  â”‚                             â”‚  - Motivo da reprovaÃ§Ã£o                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚               â”‚                                                                          â”‚
â”‚               â–¼                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚ Drive - Upload Observacao   â”‚  Upload do arquivo observacao_timestamp.txt           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚               â”‚                                                                          â”‚
â”‚               â–¼                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                 â”‚
â”‚  â”‚ Check PDF Exists?   â”‚                                                                 â”‚
â”‚  â”‚ (IF node)           â”‚                                                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                 â”‚
â”‚             â”‚                                                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                                                    â”‚
â”‚     â”‚               â”‚                                                                    â”‚
â”‚     â–¼               â–¼                                                                    â”‚
â”‚ [Com PDF]      [Sem PDF]                                                                 â”‚
â”‚     â”‚               â”‚                                                                    â”‚
â”‚     â–¼               â”‚                                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                                                    â”‚
â”‚ â”‚Drive Upload â”‚     â”‚                                                                    â”‚
â”‚ â”‚   PDF       â”‚     â”‚                                                                    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚                                                                    â”‚
â”‚        â”‚            â”‚                                                                    â”‚
â”‚        â–¼            â”‚                                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                                                    â”‚
â”‚ â”‚Set PDF Link â”‚     â”‚                                                                    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚                                                                    â”‚
â”‚        â”‚            â”‚                                                                    â”‚
â”‚        â”‚      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                              â”‚
â”‚        â”‚      â”‚Set No PDF â”‚                                                              â”‚
â”‚        â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                              â”‚
â”‚        â”‚            â”‚                                                                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                                    â”‚
â”‚              â”‚                                                                           â”‚
â”‚              â–¼                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                 â”‚
â”‚  â”‚ Merge PDF Paths     â”‚  Combina os caminhos independente do branch                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                 â”‚
â”‚             â”‚                                                                            â”‚
â”‚             â–¼                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ BigQuery - Update Rejection   â”‚  UPDATE status = 'REPROVADO',                        â”‚
â”‚  â”‚                               â”‚  rejection_reason = motivo,                          â”‚
â”‚  â”‚                               â”‚  rejection_count = +1                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                 â”‚                                                                        â”‚
â”‚                 â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚ Email - Rejection Notification    â”‚  Envia email HTML profissional ao fornecedor   â”‚
â”‚  â”‚                                   â”‚  com: PI, Cliente, Motivo, Link do PDF          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                 â”‚                                                                        â”‚
â”‚                 â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚  â”‚ Respond Rejection     â”‚  { success: true, message: "Reprovado e notificado" }       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                               â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6. `health_check` â€” VerificaÃ§Ã£o de SaÃºde

**O que faz**: Retorna o status de conectividade dos serviÃ§os.

```json
{
  "status": "online",
  "timestamp": "2026-02-04T12:00:00-03:00",
  "services": {
    "bigquery": "connected",
    "drive": "connected",
    "smtp": "connected"
  }
}
```

---

## ğŸ”§ ConfiguraÃ§Ã£o do Webhook

### Headers CORS Configurados

O workflow configura automaticamente os headers para permitir requisiÃ§Ãµes do frontend:

| Header | Valor |
|--------|-------|
| `Access-Control-Allow-Origin` | `*` |
| `Access-Control-Allow-Methods` | `GET, POST, OPTIONS` |
| `Access-Control-Allow-Headers` | `Content-Type, Authorization` |

### Endpoint

```
POST https://n8n.seu-servidor.com/webhook/painel-aprovacao
```

---

## ğŸ“§ Template do Email de ReprovaÃ§Ã£o

O email enviado ao fornecedor segue este design:

```html
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€ RAINBOW BAR â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚               âš ï¸ CHECKING REPROVADO                     â”‚
â”‚                   Tentativa #2                          â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âš ï¸ AÃ‡ÃƒO NECESSÃRIA                                â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ O checking foi analisado e NÃƒO foi aprovado.     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  ğŸ“‹ DETALHES:                                           â”‚
â”‚  â€¢ PI: PI-12345                                         â”‚
â”‚  â€¢ Cliente: Coca-Cola                                   â”‚
â”‚                                                         â”‚
â”‚  ğŸ“ MOTIVO DA REPROVAÃ‡ÃƒO:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ A imagem do outdoor estÃ¡ fora de foco.            â”‚  â”‚
â”‚  â”‚ Favor reenviar com melhor qualidade.              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  ğŸ“ DOCUMENTO ANEXADO:                                  â”‚
â”‚  [Ver Documento]                                        â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Hub de AutomaÃ§Ã£o                             â”‚
â”‚         checking@empresa.com                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€ RAINBOW BAR â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Estrutura das Tabelas BigQuery

### Tabela: `checking_logs`

| Campo | Tipo | DescriÃ§Ã£o |
|-------|------|-----------|
| `id` | STRING | Timestamp Ãºnico (chave primÃ¡ria) |
| `n_pi` | STRING | NÃºmero do PI (Pedido de InserÃ§Ã£o) |
| `cliente` | STRING | Nome do cliente anunciante |
| `veiculo` | STRING | VeÃ­culo de mÃ­dia (TV, rÃ¡dio, OOH) |
| `nome` | STRING | Nome do fornecedor |
| `email` | STRING | Email do fornecedor |
| `webViewLink` | STRING | Link da pasta no Google Drive |
| `totalArquivos` | INTEGER | Quantidade de arquivos enviados |
| `approval_status` | STRING | PENDENTE / APROVADO / REPROVADO |
| `approval_date` | TIMESTAMP | Data/hora da decisÃ£o |
| `approval_user` | STRING | Email de quem aprovou/reprovou |
| `rejection_reason` | STRING | Motivo da reprovaÃ§Ã£o |
| `rejection_count` | INTEGER | NÃºmero de reprovaÃ§Ãµes |
| `data_envio` | STRING | Data de envio formatada |

---

## ğŸš€ Como Importar o Workflow

1. Abra sua instÃ¢ncia n8n
2. VÃ¡ em **Settings** â†’ **Import**
3. Selecione o arquivo `n8n_workflow_FINAL_V6.json`
4. Configure as credenciais:
   - Google BigQuery OAuth2
   - Google Drive OAuth2
   - SMTP Account
5. Ative o workflow

---

## ğŸ”— Links Relacionados

- [README Principal](./README.md)
- [DocumentaÃ§Ã£o TÃ©cnica](./DOCUMENTATION.md)
- [Arquivo do Workflow](./n8n_workflow_FINAL_V6.json)

---

Â© 2026 Hub de AutomaÃ§Ã£o | Desenvolvido por Phillipe (Nero)
