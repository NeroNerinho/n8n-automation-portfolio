{
  "name": "Painel Checking - teste",
  "nodes": [
    {
      "parameters": {
        "content": "## Webhook\n**Webhook — Entrada do Formulário**\n- Método obrigatório: POST  \n- Rota fixa: /CheckingForm  \n- Cabeçalhos de segurança ativados:\n  - X-Content-Type-Options\n  - X-Frame-Options\n  - X-XSS-Protection\n  - Strict-Transport-Security\n- Rejeita requisições suspeitas ou sem formato adequado  \n→ Função: receber dados com segurança máxima.\n\n",
        "height": 464,
        "width": 448,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5184,
        -1712
      ],
      "typeVersion": 1,
      "id": "b0efebab-5e51-4a7b-b83c-de202a77a134",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Verificação de Ação\n\n**IF — É Busca de PI?**\nO fluxo verifica se o campo `action` é igual a `buscar_pi`.  \nSe for:\n- Vai direto ao Google Sheets para buscar informações da PI  \nCaso contrário:\n- Continua para o processo de validação completa da submissão.\n",
        "height": 448,
        "width": 448,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4720,
        -1712
      ],
      "typeVersion": 1,
      "id": "186de071-4144-4bbd-ae22-3d6571e078ca",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Buscar PI no Google Sheets\n\n**Google Sheets — Buscar Dados da PI**\n- Conecta na planilha de PIs (gid=0).\n- Filtra pela coluna `N_PI` usando o valor recebido do formulário.\n- Sanitiza o `N_PI` antes da busca para remover caracteres inválidos.\n→ Função: obter os detalhes da PI (Cliente, Campanha, Veículo, Meio) para o front-end.\n",
        "height": 448,
        "width": 464,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4256,
        -1712
      ],
      "typeVersion": 1,
      "id": "81176bf2-39cd-4162-9cc4-903b3beb7a70",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Formatar Resposta da PI\n\n**Code — Preparar JSON da PI**\n- Recebe os dados do Google Sheets.\n- Se a PI não for encontrada, retorna `{ success: false, error: 'PI não encontrada' }`.\n- **Lógica de Detecção:** Se o campo `MEIO` estiver vazio, analisa o `VEICULO` por palavras-chave (outdoor, busdoor, etc.) e define o meio como `ME` (Mídia Externa) automaticamente.\n- Retorna um JSON limpo e formatado com os dados da PI.\n\n",
        "height": 400,
        "width": 464,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3776,
        -1712
      ],
      "typeVersion": 1,
      "id": "8e07de8a-f8a2-446b-b971-74bb3f04f382",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Resposta JSON da Consulta\n\n**Responder — JSON da PI**\nRetorna ao Webhook o objeto formatado.\nFluxo encerra aqui quando a ação é `buscar_pi`.\n\n\n",
        "height": 304,
        "width": 464,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3296,
        -1680
      ],
      "typeVersion": 1,
      "id": "711267d0-5288-4e64-9732-1022d8bb475e",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Validar Submissão\n\n**Code — Validação e Sanitização Completa**\nFunções aplicadas:\n- Sanitização de todos os campos\n- Remoção de caracteres perigosos (< > ' \" `)\n- Validação de e-mail\n- Validação de PI\n- Restrição de tamanho por campo\n- Organização dos dados sanitizados em `sanitizedData`\n\nTambém valida anexos conforme o meio:\n- DO, ME, MO, BD, OD, FL, MI, MN, RD, RF, CI, JN, RE, AT, TV, TA, IN\n\nRetorno:\n- success: true/false\n- message: descrição exata do erro\n",
        "height": 576,
        "width": 448,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4816,
        -1072
      ],
      "typeVersion": 1,
      "id": "9eb52472-0724-43cf-9ec9-d89bfb1941a4",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "## IF: Validação\n\n**IF — Validação OK?**\nSe `validationResult.success` for TRUE → fluxo continua  \nSe FALSE → retorna erro formatado em JSON com HTTP 400\n",
        "height": 336,
        "width": 448,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4352,
        -976
      ],
      "typeVersion": 1,
      "id": "d34df5d1-5f16-48bf-8858-52c98df3c3c3",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## Responder erro\n\n**Responder — Erro de Validação**\nQuando a validação falha:\n- Retorna { success: false, message: <detalhe> }\n- HTTP status: 400\n→ Ajuda o usuário a corrigir antes de reenviar.\n",
        "height": 400,
        "width": 448
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3888,
        -752
      ],
      "typeVersion": 1,
      "id": "013e7d00-6685-44af-afc6-c1c5f5870a95",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "## Upload é Link do Drive\n\n**IF — É Link do Drive?**\nVerifica se `uploadMethod` é `drive_link`.\n\nSe **TRUE**:\n- Vai para o fluxo `Preparar Log Link1`.\nOBS: `Essa função esta desativada no front end`\n\nSe **FALSE** (upload é binário):\n- Fluxo segue para a busca da pasta do cliente no Drive.\n",
        "height": 416,
        "width": 448,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3888,
        -1184
      ],
      "typeVersion": 1,
      "id": "60fe0f0c-a1b1-4faa-ad46-c85ea43a5574",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "## Pasta do Cliente Existe?\n\n **IF — Pasta Cliente Existe?**\nVerifica se a busca no Drive retornou um `id`.\n\nSim → (TRUE) continua para `Definir ID da Pasta Cliente1`\nNão → (FALSE) continua para `Criar Pasta Cliente1`\n\n\n",
        "height": 368,
        "width": 448,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2944,
        -592
      ],
      "typeVersion": 1,
      "id": "d92d58fb-4849-49a2-98c5-0721ccaefa25",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "## Preparar Log (Link do Drive)\n\n**Code — Formatar Log (Link)**\n- Executado se o usuário enviou um link do Drive.\n- Coleta os dados da submissão (PI, Cliente, etc.).\n- Define `uploadMethod: 'drive_link'`.\n- Define `totalArquivos: 'Via Link Drive'`.\n- Usa o `body.drive_link` como `webViewLink`.\n- Formata o objeto JSON final para o Log no Sheets e para o e-mail.\n",
        "height": 416,
        "width": 448,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3424,
        -1296
      ],
      "typeVersion": 1,
      "id": "50c76355-f507-497d-97c5-79acf0b0b125",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "## Buscar Pasta do Cliente (Drive)\n\n**Google Drive — Buscar Pasta do Cliente**\nProcura pasta com o nome do cliente:\n- Nome em UPPERCASE\n- Dentro da pasta pai definida (`1OEL4Mt...`)\n- Ignora pastas excluídas (`trashed=false`)\n→ Garante organização por cliente.\n",
        "height": 352,
        "width": 448,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3424,
        -864
      ],
      "typeVersion": 1,
      "id": "6805e9b4-4e81-4922-9017-7a2fc6bdfbf8",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "## Criar Pasta do Cliente (Nova)\n\n**Google Drive — Criar Pasta**\n- Executado se a pasta do cliente **não foi encontrada** (branch 'false' do IF).\n- Cria uma nova pasta no Google Drive.\n- Nome: Nome do cliente em MAIÚSCULAS.\n- Local: Dentro da pasta raiz de checkings.\n- (O fluxo deste branch deveria se conectar ao \"Criar Pasta PI1\" após definir o ID da pasta criada).\n",
        "height": 416,
        "width": 432,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2464,
        -192
      ],
      "typeVersion": 1,
      "id": "dd16c49c-fa7e-41c8-a6eb-04e6fad36d59",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "CheckingForm",
        "responseMode": "responseNode",
        "options": {
          "rawBody": "={{ false }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "X-Content-Type-Options",
                "value": "nosniff"
              },
              {
                "name": "X-Frame-Options",
                "value": "DENY"
              },
              {
                "name": "X-XSS-Protection",
                "value": "1; mode=block"
              },
              {
                "name": "Strict-Transport-Security",
                "value": "max-age=31536000"
              }
            ]
          }
        }
      },
      "id": "7bbdf60c-9a32-4809-800e-e5300d98018f",
      "name": "Webhook POST1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -5056,
        -1408
      ],
      "webhookId": "checking-form-post",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "action-check",
              "leftValue": "={{ $json.body.action }}",
              "rightValue": "buscar_pi",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8e36510e-5d6e-458b-a4ad-33b2ba4981e9",
      "name": "É Busca de PI?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -4512,
        -1408
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "N_PI",
              "lookupValue": "={{ $json.body.n_pi.replace(/[^a-zA-Z0-9-_]/g, '') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "3e85027d-21cf-4909-b332-68c0664ef464",
      "name": "Buscar PI no Sheets1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -4064,
        -1424
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": "ADAdmin N8N"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nif (items.length === 0 || !items[0].json.N_PI) {\n  return [{ json: { success: false, error: 'PI não encontrada' } }];\n}\n\nconst pi = items[0].json;\n\n\n// LÓGICA: DETECÇÃO AUTOMÁTICA DE MÍDIA EXTERNA\n\n\nlet meioFinal = pi.MEIO || '';\n\n// Se o meio não foi preenchido, tenta detectar automaticamente\nif (!meioFinal || meioFinal.trim() === '') {\n  const veiculo = (pi.VEICULO || '').toLowerCase();\n  \n  \n  const palavrasChaveME = [\n    'outdoor', 'mub', 'busdoor', 'taxidoor', \n    'painel', 'placa', 'frontlight', 'backlight',\n    'empena', 'topo', 'lateral', 'fachada',\n    'billboard', 'testeira', 'totem',\n    'abrigo', 'relogio', 'mobiliario urbano',\n    'mobiliário urbano', 'relógio'\n  ];\n  \n\n  const isMidiaExterna = palavrasChaveME.some(termo => \n    veiculo.includes(termo)\n  );\n  \n  if (isMidiaExterna) {\n    meioFinal = 'ME';\n    console.log('✅ [N8N] Mídia Externa detectada automaticamente');\n    console.log('   Veículo:', pi.VEICULO);\n    console.log('   Meio definido como: ME');\n  }\n}\n\n\nreturn [{\n  json: {\n    success: true,\n    cliente: pi.CLIENTE || '',\n    campanha: pi.CAMPANHA || '',\n    produto: pi.PRODUTO || '',\n    periodo: pi.PERIODO || '',\n    veiculo: pi.VEICULO || '',\n    meio: meioFinal  \n  }\n}];"
      },
      "id": "fea58324-e68f-4085-8415-1839a98ad299",
      "name": "Formatar Resposta PI1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3584,
        -1440
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "e9314594-40f0-49e0-8eff-8b6dd48f1e2b",
      "name": "Responder JSON PI1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -3152,
        -1520
      ]
    },
    {
      "parameters": {
        "jsCode": "// VALIDAÇÃO HÍBRIDA COM SANITIZAÇÃO\nconst item = $input.item;\nconst body = item.json.body || {};\nconst binary = item.binary || {};\nconst erros = [];\n\n//  FUNÇÃO DE SANITIZAÇÃO\nfunction sanitize(input, maxLength = 500) {\n  if (!input) return '';\n  return String(input)\n    .trim()\n    .replace(/[<>\\\"'`]/g, '') // Remove caracteres perigosos\n    .substring(0, maxLength);\n}\n\n//  VALIDAÇÃO DE EMAIL\nfunction isValidEmail(email) {\n  const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,10}$/;\n  return regex.test(email) && email.length <= 254;\n}\n\n// VALIDAÇÃO DE PI\nfunction isValidPI(pi) {\n  const regex = /^[a-zA-Z0-9-_]{1,50}$/;\n  return regex.test(pi);\n}\n\n// 1. SANITIZAR TODOS OS INPUTS\nconst nome = sanitize(body.nome, 200);\nconst email = sanitize(body.email, 254);\nconst telefone = sanitize(body.telefone, 20);\nconst n_pi = sanitize(body.n_pi, 50);\nconst cliente = sanitize(body.cliente, 200);\nconst campanha = sanitize(body.campanha, 200);\nconst produto = sanitize(body.produto, 200);\nconst periodo = sanitize(body.periodo, 100);\nconst veiculo = sanitize(body.veiculo, 200);\nconst meio = sanitize(body.meio, 10);\nconst observacoes = sanitize(body.observacoes, 2000);\n\n// 2. VALIDAÇÕES DE FORMATO\nif (!nome || nome.length < 3) {\n  erros.push('Nome inválido');\n}\n\nif (!isValidEmail(email)) {\n  erros.push('E-mail inválido');\n}\n\nif (!isValidPI(n_pi)) {\n  erros.push('Número de PI inválido');\n}\n\n// 3. ARMAZENAR DADOS SANITIZADOS\nitem.json.sanitizedData = {\n  nome, email, telefone, n_pi, cliente, campanha, \n  produto, periodo, veiculo, meio, observacoes\n};\n\n// 4. VALIDAÇÃO DE ARQUIVOS\nconst uploadMethod = body.upload_method;\n\nif (uploadMethod === 'binary') {\n  item.json.uploadMethod = 'binary';\n  \n  const anexosRequeridosPorMeio = {\n    'DO': ['relatorio_fotografico_do', 'relatorio_exibicoes_do', 'video_diurno_do'],\n    'ME': ['relatorio_enderecos_me', 'fotos_pontos_me'],\n    'MO': ['relatorio_estacoes_mo', 'fotos_videos_mo'],\n    'BD': ['comprovante_bd'],\n    'OD': ['comprovante_od'],\n    'FL': ['comprovante_fl'],\n    'MI': ['comprovante_mi'],\n    'MN': ['comprovante_mi'],\n    'RD': ['comprovante_radio'],\n    'RF': ['comprovante_radio'],\n    'CI': ['comprovante_cinema'],\n    'JN': ['comprovante_impresso'],\n    'RE': ['comprovante_impresso'],\n    'AT': ['comprovante_ativacao'],\n    'TV': ['comprovante_tv'],\n    'TA': ['comprovante_tv'],\n    'IN': ['comprovante_internet']\n  };\n\n  const camposAnexoRequeridos = anexosRequeridosPorMeio[meio];\n\n  if (!meio) {\n    erros.push('Campo Meio não preenchido');\n  } else if (!camposAnexoRequeridos) {\n    erros.push(`Meio '${meio}' não possui regras definidas`);\n  } else {\n    const anexosFaltando = [];\n    \n    camposAnexoRequeridos.forEach(campo => {\n      const temArquivo = Object.keys(binary).some(key => {\n        return key === campo || key.startsWith(campo + '_');\n      });\n      \n      if (!temArquivo) {\n        anexosFaltando.push(campo);\n      }\n    });\n    \n    if (anexosFaltando.length > 0) {\n      erros.push(`Anexos faltando: ${anexosFaltando.join(', ')}`);\n    }\n  }\n}\n\nitem.json.validationResult = erros.length > 0\n  ? { success: false, message: erros.join('; ') }\n  : { success: true, message: 'Validação OK' };\n\nreturn [item];"
      },
      "id": "f8bff276-f3ea-432d-8d3d-4f8232707581",
      "name": "Validar Submissão1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4688,
        -624
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "validacao-ok",
              "leftValue": "={{ Boolean($json.validationResult?.success) }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "8e64ec4a-9fde-424b-a12c-c1e8009946e1",
      "name": "Validação OK?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4208,
        -784
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": false, \"message\": $json.validationResult.message || \"Erro na validação.\" } }}",
        "options": {
          "responseCode": 400
        }
      },
      "id": "e3c46041-3750-4645-bd27-659f5767fc9f",
      "name": "Responder Erro1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -3760,
        -496
      ]
    },
    {
      "parameters": {
        "jsCode": "// PROCESSA LINK DO DRIVE (≥500MB)\nconst submissionData = $items('Validar Submissão1')[0].json;\nconst body = submissionData.body;\n\nreturn [{\n  json: {\n_PI: body.n_pi || 'N/A',\n    cliente: body.cliente || 'N/A',\n    veiculo: body.veiculo || 'N/A',\n    nome: body.nome || 'N/A',\n    email: body.email || 'N/A',\n    telefone: body.telefone || 'N/A',\n    meio: body.meio || 'N/A',\n    observacoes: body.observacoes || '',\n    totalArquivos: 'Via Link Drive',\n    uploadMethod: 'drive_link',\n    webViewLink: body.drive_link || 'Link não fornecido'\n  }\n}];"
      },
      "id": "dcb7a255-a0b4-4d80-97df-d3d05bb81db0",
      "name": "Preparar Log Link1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3248,
        -1008
      ]
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "={{ \"name='\" + $items('Validar Submissão1')[0].json.body.cliente.trim().toUpperCase() + \"' and mimeType='application/vnd.google-apps.folder' and '1OEL4MtYKd5Tg-ZOmsIRG9RQkvfX-xs_s' in parents and trashed=false\" }}",
        "filter": {},
        "options": {}
      },
      "id": "5f5c73ff-a23e-4ef6-b107-d722b1bd3fbb",
      "name": "Buscar Pasta Cliente1",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -3280,
        -656
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "pasta-existe",
              "leftValue": "={{ $json.id != null }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "749b653d-a1cf-4c5b-872c-708f1cf12237",
      "name": "Pasta Cliente Existe?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -2800,
        -384
      ]
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $items('Validar Submissão1')[0].json.body.cliente.toUpperCase() }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1OEL4MtYKd5Tg-ZOmsIRG9RQkvfX-xs_s",
          "mode": "list"
        },
        "options": {}
      },
      "id": "2f4e701b-a459-41f8-aeae-e0006884e6b9",
      "name": "Criar Pasta Cliente1",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -2320,
        96
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e8a1f223-f20b-4d4a-9460-847ed5802ef8",
              "name": "=clientFolderId",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {
          "dotNotation": false
        }
      },
      "id": "0d115478-f901-4f54-aeb4-a6db0f8f26ff",
      "name": "Definir ID da Pasta Cliente1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2336,
        -368
      ]
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ 'PI_' + $items('Validar Submissão1')[0].json.sanitizedData.n_pi.replace(/[^a-zA-Z0-9-_]/g, '_') + '_' + $items('Validar Submissão1')[0].json.sanitizedData.cliente.replace(/[^a-zA-Z0-9-_]/g, '_') + '_' + $now.toFormat('yyyyMMdd_HHmmss') }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": "={{ $json.clientFolderId }}",
        "options": {}
      },
      "id": "5675827c-7971-4214-a81e-bf7d4ac8b51d",
      "name": "Criar Pasta PI1",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1856,
        -336
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const submissionItem = $items('Validar Submissão1')[0];\nconst piFolderId = $json.id;\n\nconst binary = submissionItem.binary || {};\nconst arquivos = [];\n\nlet totalArquivos = 0;\n\nfor (const key in binary) {\n  totalArquivos++;\n  arquivos.push({\n    json: {\n      ...submissionItem.json,\n      piFolderId: piFolderId,\n      nomeArquivoOriginal: binary[key].fileName || `arquivo_${totalArquivos}`,\n      mimeType: binary[key].mimeType || 'application/octet-stream',\n      totalArquivos: 0\n    },\n    binary: {\n      data: binary[key]\n    }\n  });\n}\n\narquivos.forEach(item => {\n  item.json.totalArquivos = totalArquivos;\n});\n\nreturn arquivos.length > 0 ? arquivos : [{ json: { erro: 'Nenhum arquivo encontrado' } }];"
      },
      "id": "50812235-9f8e-4822-abcc-1e39aaeb14ac",
      "name": "Separar Cada Arquivo1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1392,
        -336
      ]
    },
    {
      "parameters": {
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": "={{ $json.piFolderId }}",
        "options": {}
      },
      "id": "0b204915-455c-47e4-bb00-40609140fefe",
      "name": "Upload Arquivo no Drive1",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -928,
        -368
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "982818de-3c32-483e-bd05-05c45a49bf09",
      "name": "Aguardar Todos Uploads1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -480,
        -384
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// PROCESSA UPLOADS BINÁRIOS (<500MB)\nconst todosUploads = $input.all();\nconst submissionData = $items('Validar Submissão1')[0].json.body;\nconst pastaPi = $items('Criar Pasta PI1')[0].json;\n\nreturn [{\n  json: {\n    n_pi: submissionData.n_pi || 'N/A',\n    cliente: submissionData.cliente || 'N/A',\n    veiculo: submissionData.veiculo || 'N/A',\n    nome: submissionData.nome || 'N/A',\n    email: submissionData.email || 'N/A',\n    telefone: submissionData.telefone || 'N/A',\n    meio: submissionData.meio || 'N/A',\n    observacoes: submissionData.observacoes || '',\n    totalArquivos: todosUploads.length,\n    uploadMethod: 'binary',\n    webViewLink: pastaPi.webViewLink || 'https://drive.google.com/drive/folders/' + pastaPi.id\n  }\n}];"
      },
      "id": "1e717008-35b6-4e5f-a3bb-69f5636727ad",
      "name": "Preparar Log Binary1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        48,
        -320
      ]
    },
    {
      "parameters": {},
      "id": "07469f9c-6df4-4ac2-a1e3-e0b6d66521bb",
      "name": "Unificar Fluxos1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -2800,
        -1088
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": 1807228652,
          "mode": "list",
          "cachedResultName": "Log_Checkings",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q/edit#gid=1807228652"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "PI": "={{ $json.sanitizedData.n_pi }}",
            "Veículo": "={{ $json.sanitizedData.veiculo }}",
            "Cliente": "={{ $json.sanitizedData.cliente }}",
            "Data": "={{ $now.toFormat('dd/MM/yyyy HH:mm:ss') }}",
            "Qtd_Arquivos": "={{ $json.totalArquivos }}",
            "Status": "Enviado"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "PI",
              "displayName": "PI",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Veículo",
              "displayName": "Veículo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cliente",
              "displayName": "Cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Data",
              "displayName": "Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Qtd_Arquivos",
              "displayName": "Qtd_Arquivos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "6a5e48a8-15ba-4cc1-a10f-3273aa4dcb73",
      "name": "Registrar Log no Sheets1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2352,
        -1232
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": "ADAdmin N8N"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "checking@teste.com.br",
        "toEmail": "checking@teste.com.br",
        "subject": "=Novo Checking Recebido - PI {{ $json.n_pi }}",
        "html": "=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\n    <title>Notificação de Checking</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background-color: #f7fafc;\">\n    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: #f7fafc;\">\n        <tr>\n            <td align=\"center\" style=\"padding: 20px;\">\n                <table width=\"650\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"max-width: 650px; width: 100%; background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\">\n                    \n                    <tr>\n                        <td height=\"4\" style=\"background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #10b981 40%, #3b82f6 60%, #8b5cf6 80%, #ec4899 100%);\"></td>\n                    </tr>\n                    \n                    <tr>\n                        <td align=\"center\" style=\"padding: 40px 40px 30px 40px; border-bottom: 1px solid #e2e8f0;\">\n                            <h1 style=\"font-family: 'Inter', Arial, sans-serif; font-size: 28px; font-weight: 800; color: #2d3748; margin: 0; text-transform: uppercase; letter-spacing: 2px;\">Novo Checking Recebido</h1>\n                            <p style=\"font-size: 16px; color: #4a5568; margin: 15px 0 0 0; line-height: 1.6;\">Um novo comprovante foi submetido com sucesso.</p>\n                        </td>\n                    </tr>\n                    \n                    <tr>\n                        <td style=\"padding: 40px;\">\n                            <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                <tr>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-right: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Cliente</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.cliente }}</p>\n                                    </td>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-left: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Nº da PI</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.n_pi }}</p>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-right: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Veículo</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.veiculo }}</p>\n                                    </td>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-left: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Data/Hora do Envio</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $now.toFormat('dd/MM/yyyy HH:mm:ss') }}</p>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td colspan=\"2\" style=\"padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Enviado por</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.nome }}</p>\n                                        <p style=\"font-size: 16px; color: #4a5568; margin: 5px 0 0 0; line-height: 1.4;\">{{ $json.email }}</p>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td colspan=\"2\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Observações</p>\n                                        <p style=\"font-size: 16px; color: #2d3748; margin: 0; font-weight: 400; background-color: #f7fafc; padding: 20px; border-radius: 4px; border: 1px solid #e2e8f0; line-height: 1.6;\">{{ $json.observacoes || 'Nenhuma observação foi fornecida.' }}</p>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                    \n                    <tr>\n                        <td align=\"center\" style=\"padding: 0 40px 40px 40px;\">\n                            <a href=\"{{ $json.webViewLink }}\" target=\"_blank\" style=\"background-color: #0033a0; color: #ffffff; padding: 16px 40px; text-decoration: none; border-radius: 4px; font-size: 15px; font-weight: 700; display: inline-block; text-transform: uppercase; letter-spacing: 0.5px; font-family: 'Inter', Arial, sans-serif;\">Acessar Arquivos no Drive</a>\n                        </td>\n                    </tr>\n\n                    <tr>\n                        <td height=\"4\" style=\"background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #10b981 40%, #3b82f6 60%, #8b5cf6 80%, #ec4899 100%);\"></td>\n                    </tr>\n\n                    <tr>\n                        <td align=\"center\" style=\"padding: 40px; background-color: #e5e7eb;\">\n                            <p style=\"font-family: 'Inter', Arial, sans-serif; font-size: 32px; font-weight: 800; color: #2d3748; margin: 0; letter-spacing: 3px;\">teste</p>\n                            <p style=\"font-family: 'Inter', Arial, sans-serif; font-size: 11px; color: #4a5568; margin: 8px 0 0 0; letter-spacing: 4px; text-transform: uppercase; font-weight: 600;\">Comunicação Integrada</p>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n</body>\n</html>",
        "options": {}
      },
      "id": "39a2cb6f-1395-4344-95d6-feb07815d8b9",
      "name": "Enviar E-mail Notificação1",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        -2320,
        -800
      ],
      "webhookId": "97ee0f28-18f2-4e12-8f98-d402e641553d",
      "credentials": {
        "smtp": {
          "id": "",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": true,\n  \"message\": \"Checking enviado com sucesso!\"\n}",
        "options": {}
      },
      "id": "293ed3db-42e7-40a4-a97c-e665573b7b90",
      "name": "Responder Sucesso1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1888,
        -800
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "check-method",
              "leftValue": "={{ $json.uploadMethod }}",
              "rightValue": "drive_link",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "006f21fa-0e3a-4216-9ed1-373d36d92352",
      "name": "Link do Driver1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -3760,
        -912
      ]
    },
    {
      "parameters": {
        "content": "## Unificar Fluxos de Log\n\n**Merge — Unificar Saída**\n- Este nó junta os dois caminhos de submissão:\n  1. O fluxo de \"Upload Binário\" (após `Preparar Log Binary1`).\n  2. O fluxo de \"Link do Drive\" (após `Preparar Log Link1`).\n- O resultado é um único item (com o JSON de log formatado) que segue para o registro no Sheets e envio de e-mail.\n",
        "height": 400,
        "width": 448,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2960,
        -1344
      ],
      "typeVersion": 1,
      "id": "f56c42bb-3125-4b69-96ba-d561b8567598",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "content": "## Registrar Log no Google Sheets\n\n**Google Sheets — Append Log**\n- Conecta na planilha \"Log_Checkings\" (aba `1807228652`).\n- Operação: **Append** (adiciona uma nova linha no final).\n- Adiciona os dados formatados vindos do nó \"Unificar Fluxos1\":\n  - PI, Veículo, Cliente, Data (atual), Qtd_Arquivos, Status ('Enviado').\n- Mantém um histórico de todas as submissões.\n",
        "height": 432,
        "width": 448,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2496,
        -1504
      ],
      "typeVersion": 1,
      "id": "56ee655d-9cef-47b3-af95-860da157e25d",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "content": "## Enviar E-mail de Notificação\n\n**Email — Notificar Equipe**\n- Envia um e-mail formatado (HTML) para `checking@teste.com.br`.\n- Assunto: \"Novo Checking Recebido - PI [N_PI]\".\n- Corpo: Contém todos os detalhes da submissão (Cliente, Veículo, Enviado por, Obs).\n- **Botão CTA:** Inclui um botão \"Acessar Arquivos no Drive\" que aponta para o `webViewLink` (seja a pasta criada ou o link enviado).\n",
        "height": 416,
        "width": 448,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2496,
        -1056
      ],
      "typeVersion": 1,
      "id": "d8fa12ca-a3dc-4cdb-95bb-94ce16612933",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "content": "## Responder Sucesso (HTTP 200)\n\n**Responder — Sucesso**\n- Envia a resposta final para o formulário (Webhook).\n- Resposta: `{ \"success\": true, \"message\": \"Checking enviado com sucesso!\" }`\n- HTTP Status: 200 (OK).\n- Informa ao usuário que a submissão foi recebida e processada.\n- Este é o fim do fluxo para uma submissão bem-sucedida.\n",
        "height": 400,
        "width": 448,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2032,
        -1056
      ],
      "typeVersion": 1,
      "id": "788879ad-cea7-49e2-a41f-5f9edb5d0771",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "content": "## Definir ID da Pasta (Existente)\n\n**Set — Armazenar ID**\n- Este nó é executado se a pasta do cliente **já existe** (branch 'true' do IF).\n- Pega o `id` da pasta encontrada no nó \"Buscar Pasta Cliente1\".\n- Armazena esse ID na variável `clientFolderId` para ser usada na criação da subpasta da PI.\n",
        "height": 400,
        "width": 448,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2480,
        -608
      ],
      "typeVersion": 1,
      "id": "eac802d3-a025-45bb-935b-0d88da89edb1",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "content": "## Criar Pasta da PI (Subpasta)\n\n**Google Drive — Criar Subpasta**\n- Cria a pasta específica para esta submissão (esta PI).\n- Local: Dentro da pasta do cliente (ID vindo de `clientFolderId`).\n- Nome da pasta: Formato dinâmico para ser único.\n  `PI_[N_PI]_[CLIENTE]_[DATA_HORA]`\n- Ex: `PI_12345_OPUS_20251114_143000`\n- O ID desta nova pasta será usado para o upload dos arquivos.\n",
        "height": 416,
        "width": 448,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2016,
        -608
      ],
      "typeVersion": 1,
      "id": "5650ec93-40f2-4f8b-a2ca-f98f52f46f4c",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "content": "## Separar Arquivos para Upload\n\n**Code — Splitter de Arquivos**\n- Pega todos os arquivos binários recebidos no formulário.\n- Pega o ID da \"Pasta da PI\" criada no nó anterior.\n- **Função de Loop:** Cria um item individual para *cada* arquivo.\n- Cada item novo contém:\n  - Os dados binários do arquivo.\n  - O ID da pasta da PI (`piFolderId`).\n  - O nome original do arquivo.\n- Isso permite que o próximo nó (\"Upload Arquivo\") rode uma vez por arquivo.\n",
        "height": 448,
        "width": 448,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1552,
        -640
      ],
      "typeVersion": 1,
      "id": "5810521a-5586-4c4d-97fd-20a51ad21e71",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "## Upload de Arquivo no Drive\n\n**Google Drive — Upload (Loop)**\n- Este nó é executado em loop, uma vez para cada item/arquivo gerado pelo nó \"Separar Arquivos\".\n- Faz o upload do arquivo binário (`binary.data`).\n- Destino: A pasta da PI (`piFolderId`) criada anteriormente.\n- O nome do arquivo no Drive será o `nomeArquivoOriginal`.\n",
        "height": 384,
        "width": 448,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1088,
        -592
      ],
      "typeVersion": 1,
      "id": "b193939b-e3ee-4117-93f0-1ab064d2af23",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "content": "## Aguardar Todos os Uploads\n\n**Merge — Combinar Execuções**\n- Este nó \"segura\" o fluxo.\n- Ele espera que **todos** os uploads de arquivos (do loop anterior) sejam concluídos.\n- Quando o último arquivo termina o upload, ele combina todos os resultados em uma única execução.\n- Garante que o fluxo só continue (para o log e e-mail) depois que tudo estiver no Drive.\n",
        "height": 464,
        "width": 448,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -624,
        -656
      ],
      "typeVersion": 1,
      "id": "408c9396-f662-46f1-8852-f12aa3e0e85b",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "content": "## Preparar Log (Upload Binário)\n\n**Code — Formatar Log (Binário)**\n- Executado após todos os uploads binários.\n- Coleta os dados da submissão (PI, Cliente, Veículo, etc.).\n- Coleta o link da pasta da PI (`webViewLink`) criada no Drive.\n- Define `uploadMethod: 'binary'`.\n- Conta o `totalArquivos` com base nos uploads.\n- Formata o objeto JSON final que será usado para o Log no Sheets e para o e-mail.\n",
        "height": 416,
        "width": 448,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -144,
        -592
      ],
      "typeVersion": 1,
      "id": "8ada6722-fc04-484d-8240-1fb17c92902c",
      "name": "Sticky Note23"
    },
    {
      "parameters": {
        "content": "",
        "height": 2016,
        "width": 5600,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5328,
        -1744
      ],
      "typeVersion": 1,
      "id": "f746178a-24fd-4d94-80a1-8e80bc6b5b9e",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "content": "#  Introdução Geral do Fluxo Checking\n\nEste fluxo recebe os dados enviados pelo formulário **Checking**, processa as informações do usuário, valida os campos preenchidos, organiza os arquivos enviados e registra tudo de forma estruturada.  \n\nA função principal é garantir que cada solicitação passe por um fluxo padronizado:  \n1. Recebe os dados do formulário  \n2. Valida e organiza os campos enviados  \n3. Verifica os anexos conforme o tipo de mídia selecionado  \n4. Prepara os uploads e cria pastas no Drive  \n5. Registra as informações no Google Sheets  \n6. Retorna ao usuário o status final do processamento\n\nO objetivo deste fluxo é manter o processo consistente, organizado e funcional para qualquer tipo de meio enviado no Checking, facilitando o controle interno e evitando erros ou entregas incompletas.\n",
        "height": 944,
        "width": 3888,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4608,
        -2880
      ],
      "typeVersion": 1,
      "id": "e97d9ea9-887a-4791-a7a3-c4071b4f963d",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "CheckingForm",
        "responseMode": "responseNode",
        "options": {
          "rawBody": "={{ false }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "X-Content-Type-Options",
                "value": "nosniff"
              },
              {
                "name": "X-Frame-Options",
                "value": "DENY"
              },
              {
                "name": "X-XSS-Protection",
                "value": "1; mode=block"
              },
              {
                "name": "Strict-Transport-Security",
                "value": "max-age=31536000"
              }
            ]
          }
        }
      },
      "id": "a4d55d28-99dd-45b4-a2eb-c89ced0d5d17",
      "name": "Webhook POST2",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -432,
        -2048
      ],
      "webhookId": "checking-form-post",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e8a1f223-f20b-4d4a-9460-847ed5802ef8",
              "name": "=clientFolderId",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {
          "dotNotation": false
        }
      },
      "id": "d7750602-292c-4498-a868-f718b6630e22",
      "name": "Definir ID da Pasta Cliente2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2624,
        -2224
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "action-check",
              "leftValue": "={{ $json.body.action }}",
              "rightValue": "buscar_pi",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fc4f65a8-4986-44bc-9be3-c1fec3756aeb",
      "name": "É Busca de PI?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -4288,
        -2384
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "N_PI",
              "lookupValue": "={{ $json.body.n_pi.replace(/[^a-zA-Z0-9-_]/g, '') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0268f466-522b-4388-ab30-778a166b54c3",
      "name": "Buscar PI no Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -4032,
        -2512
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": "ADAdmin N8N"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nif (items.length === 0 || !items[0].json.N_PI) {\n  return [{ json: { success: false, error: 'PI não encontrada' } }];\n}\n\nconst pi = items[0].json;\n\n\n// LÓGICA: DETECÇÃO AUTOMÁTICA DE MÍDIA EXTERNA\n\n\nlet meioFinal = pi.MEIO || '';\n\n// Se o meio não foi preenchido, tenta detectar automaticamente\nif (!meioFinal || meioFinal.trim() === '') {\n  const veiculo = (pi.VEICULO || '').toLowerCase();\n  \n  \n  const palavrasChaveME = [\n    'outdoor', 'mub', 'busdoor', 'taxidoor', \n    'painel', 'placa', 'frontlight', 'backlight',\n    'empena', 'topo', 'lateral', 'fachada',\n    'billboard', 'testeira', 'totem',\n    'abrigo', 'relogio', 'mobiliario urbano',\n    'mobiliário urbano', 'relógio'\n  ];\n  \n\n  const isMidiaExterna = palavrasChaveME.some(termo => \n    veiculo.includes(termo)\n  );\n  \n  if (isMidiaExterna) {\n    meioFinal = 'ME';\n    console.log('✅ [N8N] Mídia Externa detectada automaticamente');\n    console.log('   Veículo:', pi.VEICULO);\n    console.log('   Meio definido como: ME');\n  }\n}\n\n\nreturn [{\n  json: {\n    success: true,\n    cliente: pi.CLIENTE || '',\n    campanha: pi.CAMPANHA || '',\n    produto: pi.PRODUTO || '',\n    periodo: pi.PERIODO || '',\n    veiculo: pi.VEICULO || '',\n    meio: meioFinal  \n  }\n}];"
      },
      "id": "7594ce74-6296-45d6-a3a9-4f87c992d6d0",
      "name": "Formatar Resposta PI",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3824,
        -2512
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "6955491b-2f7e-41ed-a345-90b1f8eea265",
      "name": "Responder JSON PI",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -3648,
        -2512
      ]
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// VALIDAÇÃO SUBMISSÃO \n// ============================================\n\nconst item = $input.item;\nconst body = item.json.body || {};\nconst binary = item.binary || {};\nconst erros = [];\n\n// FUNÇÃO DE SANITIZAÇÃO\nfunction sanitize(input, maxLength = 500) {\n  if (!input) return '';\n  return String(input)\n    .trim()\n    .replace(/[<>\"'`]/g, '')\n    .substring(0, maxLength);\n}\n\n// VALIDAÇÃO DE EMAIL\nfunction isValidEmail(email) {\n  const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,10}$/;\n  return regex.test(email) && email.length <= 254;\n}\n\n// VALIDAÇÃO DE PI\nfunction isValidPI(pi) {\n  const regex = /^[a-zA-Z0-9-_]{1,50}$/;\n  return regex.test(pi);\n}\n\n// 1. SANITIZAR TODOS OS INPUTS\nconst nome = sanitize(body.nome, 200);\nconst email = sanitize(body.email, 254);\nconst telefone = sanitize(body.telefone, 20);\nconst n_pi = sanitize(body.n_pi, 50);\nconst cliente = sanitize(body.cliente, 200);\nconst campanha = sanitize(body.campanha, 200);\nconst produto = sanitize(body.produto, 200);\nconst periodo = sanitize(body.periodo, 100);\nconst veiculo = sanitize(body.veiculo, 200);\nconst meio = sanitize(body.meio, 10);\nconst observacoes = sanitize(body.observacoes, 2000);\n\n// 2. VALIDAÇÕES DE FORMATO BÁSICO\nif (!nome || nome.length < 3) erros.push('Nome inválido');\nif (!isValidEmail(email)) erros.push('E-mail inválido');\nif (!isValidPI(n_pi)) erros.push('Número de PI inválido');\n\n// 3. ARMAZENAR DADOS SANITIZADOS\nitem.json.sanitizedData = {\n  nome, email, telefone, n_pi, cliente, campanha, \n  produto, periodo, veiculo, meio, observacoes\n};\n\n// 4. VALIDAÇÃO DE ARQUIVOS POR MEIO (Mapeamento exato do index.html)\nconst uploadMethod = body.upload_method;\n\nif (uploadMethod === 'binary') {\n  item.json.uploadMethod = 'binary';\n  \n  // MAPA CORRIGIDO CONFORME SEU HTML\n  const anexosRequeridosPorMeio = {\n    // DOOH\n    'DO': ['relatorio_fotografico_do', 'relatorio_exibicoes_do', 'video_diurno_do'],\n    \n    // Mídia Exterior\n    'ME': ['relatorio_enderecos_me', 'fotos_pontos_me'],\n    'BD': ['comprovante_bd'],\n    'OD': ['comprovante_od'],\n    'FL': ['comprovante_fl'],\n    'GD': ['comprovante_gigadoor'],\n    \n    // Metrô (Corrigido: HTML usa sufixo _mo para MT)\n    'MT': ['relatorio_estacoes_mo', 'fotos_videos_mo'], \n    \n    // Materiais (Informática, Limpeza, Escritório)\n    'MI': ['comprovante_material'],\n    'ML': ['comprovante_material'],\n    'MO': ['comprovante_material'],\n    \n    // Mídia Interna (MN usa _mi)\n    'MN': ['comprovante_mi'],\n    \n    // Rádio\n    'RD': ['comprovante_radio'],\n    'RF': ['comprovante_radio'],\n    'RA': ['comprovante_radio'],\n    \n    // Cinema\n    'CI': ['comprovante_cinema'],\n    'CN': ['comprovante_cinema'],\n    \n    // Impresso\n    'JN': ['comprovante_impresso'],\n    'RE': ['comprovante_impresso'],\n    \n    // TV e Patrocínios\n    'TV': ['comprovante_tv'],\n    'TA': ['comprovante_tv'],\n    \n    // Internet e Digital\n    'IN': ['comprovante_internet'],\n    'IA': ['comprovante_internet'],\n    'IB': ['comprovante_internet'],\n    'ID': ['comprovante_internet'],\n    'IS': ['comprovante_internet'],\n    'IV': ['comprovante_internet'],\n    'MS': ['comprovante_internet'],\n    \n    // Ativação e Eventos\n    'AT': ['comprovante_ativacao'],\n    'EV': ['comprovante_evento'],\n    \n    // Produção (Vários códigos)\n    'PA': ['comprovante_producao'], 'PC': ['comprovante_producao'], \n    'PD': ['comprovante_producao'], 'PV': ['comprovante_producao'], \n    'PY': ['comprovante_producao'], 'BP': ['comprovante_producao'], \n    'CP': ['comprovante_producao'], 'EP': ['comprovante_producao'], \n    'PF': ['comprovante_producao'], 'PH': ['comprovante_producao'], \n    'PI': ['comprovante_producao'], 'PJ': ['comprovante_producao'], \n    'PM': ['comprovante_producao'], 'PN': ['comprovante_producao'], \n    'PO': ['comprovante_producao'], 'PS': ['comprovante_producao'], \n    'PT': ['comprovante_producao'], 'PW': ['comprovante_producao'], \n    'PB': ['comprovante_producao'],\n    \n    // Gráfica\n    'GO': ['comprovante_grafica'],\n    'GS': ['comprovante_grafica'],\n    'FT': ['comprovante_grafica'],\n    \n    // Profissionais\n    'FO': ['comprovante_profissional'], 'IL': ['comprovante_profissional'],\n    'CA': ['comprovante_profissional'], 'TR': ['comprovante_profissional'],\n    'FP': ['comprovante_profissional'], 'RP': ['comprovante_profissional'],\n    \n    // Outros Diversos\n    'BR': ['comprovante_brinde'], 'BV': ['comprovante_brinde'],\n    'DE': ['comprovante_despesa'], 'FE': ['comprovante_despesa'],\n    'RT': ['comprovante_despesa'], 'VE': ['comprovante_despesa'],\n    'IP': ['comprovante_pesquisa'], 'PQ': ['comprovante_pesquisa'],\n    'LO': ['comprovante_locacao'],\n    'MD': ['comprovante_maladireta'],\n    'CS': ['comprovante_carrosom'],\n    'RL': ['comprovante_criacao'], 'CR': ['comprovante_criacao'],\n    'FI': ['comprovante_fidelidade'],\n    'AS': ['comprovante_assessoria'],\n    'MA': ['comprovante_outros'], 'OU': ['comprovante_outros'], 'TO': ['comprovante_outros']\n  };\n\n  const camposAnexoRequeridos = anexosRequeridosPorMeio[meio];\n\n  if (!meio) {\n    erros.push('Campo Meio não preenchido');\n  } else if (!camposAnexoRequeridos) {\n    // Se o meio vier vazio ou inválido, deixamos passar se tiver arquivos, \n    // ou bloqueamos. Aqui vou deixar flexível para não travar meios novos.\n    if (Object.keys(binary).length === 0) {\n       erros.push(`Meio '${meio}' requer anexos, mas nenhum foi enviado.`);\n    }\n  } else {\n    const anexosFaltando = [];\n    \n    camposAnexoRequeridos.forEach(campo => {\n      // Verifica se existe alguma chave no binary que comece com o nome do campo\n      // Ex: 'relatorio_fotografico_do' ou 'relatorio_fotografico_do_1'\n      const temArquivo = Object.keys(binary).some(key => {\n        return key === campo || key.startsWith(campo);\n      });\n      \n      if (!temArquivo) {\n        anexosFaltando.push(campo);\n      }\n    });\n    \n    if (anexosFaltando.length > 0) {\n      erros.push(`Anexos faltando: ${anexosFaltando.join(', ')}`);\n    }\n  }\n}\n\n// ID ÚNICO DA SUBMISSÃO\nconst submissionId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\nitem.json.submissionId = submissionId;\n\n// RESULTADO FINAL\nitem.json.validationResult = erros.length > 0\n  ? { success: false, message: erros.join('; '), statusCode: 400 }\n  : { success: true, message: 'Validação OK' };\n\n// LOG DETALHADO\nconst totalArquivos = Object.keys(binary).length;\nconst statusIcon = item.json.validationResult.success ? '✅' : '❌';\n\nconsole.log(`${statusIcon} [${submissionId}] Meio: ${meio} | Arquivos: ${totalArquivos}`);\n\nif (!item.json.validationResult.success) {\n  console.log(`⚠️ Erros: ${erros.join(' | ')}`);\n}\n\nreturn [item];"
      },
      "id": "9cabc44e-cb88-4738-a7d6-69a1929ef3e5",
      "name": "Validar Submissão",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4048,
        -2240
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "validacao-ok",
              "leftValue": "={{ Boolean($json.validationResult?.success) }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "f19761de-789a-4b71-b57e-2dc9b164e24f",
      "name": "Validação OK?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3840,
        -2256
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": false, \"message\": $json.validationResult.message || \"Erro na validação.\" } }}",
        "options": {
          "responseCode": "={{ $json.validationResult.statusCode || 400 }}"
        }
      },
      "id": "4627c2c8-c4c9-4dfe-bc8a-f49a67faecb8",
      "name": "Responder Erro",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -3616,
        -2128
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "check-method",
              "leftValue": "={{ $json.uploadMethod }}",
              "rightValue": "drive_link",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8a5d69ed-b4fa-41cc-9be6-1fb17c7f9783",
      "name": "Link do Driver",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -3664,
        -2352
      ]
    },
    {
      "parameters": {
        "jsCode": "// PROCESSA LINK DO DRIVE (≥500MB)\nconst submissionData = $items('Validar Submissão')[0].json;\nconst body = submissionData.body;\n\nreturn [{\n  json: {\n_PI: body.n_pi || 'N/A',\n    cliente: body.cliente || 'N/A',\n    veiculo: body.veiculo || 'N/A',\n    nome: body.nome || 'N/A',\n    email: body.email || 'N/A',\n    telefone: body.telefone || 'N/A',\n    meio: body.meio || 'N/A',\n    observacoes: body.observacoes || '',\n    totalArquivos: 'Via Link Drive',\n    uploadMethod: 'drive_link',\n    webViewLink: body.drive_link || 'Link não fornecido'\n  }\n}];"
      },
      "id": "ae93d9bb-fd54-4753-a283-5cde7557ac41",
      "name": "Preparar Log Link",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3344,
        -2496
      ]
    },
    {
      "parameters": {},
      "id": "58e0094d-b68a-46fc-9cf9-fb395094e97d",
      "name": "Unificar Fluxos",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1600,
        -2480
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": 1807228652,
          "mode": "list",
          "cachedResultName": "Log_Checkings",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q/edit#gid=1807228652"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "PI": "={{ $json.n_pi }}",
            "Veículo": "={{ $json.veiculo }}",
            "Cliente": "={{ $json.cliente }}",
            "Data": "={{ $now.toFormat('dd/MM/yyyy HH:mm:ss') }}",
            "Qtd_Arquivos": "={{ $json.totalArquivos }}",
            "Status": "Enviado",
            "webViewLink": "={{ $json.webViewLink }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "PI",
              "displayName": "PI",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Veículo",
              "displayName": "Veículo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cliente",
              "displayName": "Cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "webViewLink",
              "displayName": "webViewLink",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data",
              "displayName": "Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Qtd_Arquivos",
              "displayName": "Qtd_Arquivos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "e760b2f2-d743-48a0-a461-95af9450dbd3",
      "name": "Registrar Log no Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -1360,
        -2640
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": "ADAdmin N8N"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "={{ \"name='\" + $items('Validar Submissão')[0].json.body.cliente.trim().toUpperCase() + \"' and mimeType='application/vnd.google-apps.folder' and '1OEL4MtYKd5Tg-ZOmsIRG9RQkvfX-xs_s' in parents and trashed=false\" }}",
        "filter": {},
        "options": {}
      },
      "id": "5a60745d-305d-4c45-9927-0b933c9cf198",
      "name": "Buscar Pasta Cliente",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -3360,
        -2208
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "pasta-existe",
              "leftValue": "={{ $json.id != null }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8b7732d5-eed9-4856-a6f9-3dc40b073b5f",
      "name": "Pasta Cliente Existe?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -3088,
        -2208
      ]
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ 'PI' + $items('Validar Submissão')[0].json.sanitizedData.n_pi.replace(/[^a-zA-Z0-9-_]/g, '') + '' + $items('Validar Submissão')[0].json.sanitizedData.cliente.replace(/[^a-zA-Z0-9-_]/g, '') + '' + $now.toFormat('yyyy/MM/dd HH:mm:ss') }}",
        "driveId": {
          "__rl": true,
          "value": "=My Drive",
          "mode": "id"
        },
        "folderId": "={{ $json.clientFolderId }}",
        "options": {}
      },
      "id": "0f20aab0-24a4-461d-8e03-963d38f41664",
      "name": "Criar Pasta PI",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -2416,
        -2224
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const submissionItem = $items('Validar Submissão')[0];\nconst piFolderId = $json.id;\n\nconst binary = submissionItem.binary || {};\nconst arquivos = [];\n\nlet totalArquivos = 0;\n\nfor (const key in binary) {\n  totalArquivos++;\n  arquivos.push({\n    json: {\n      ...submissionItem.json,\n      piFolderId: piFolderId,\n      nomeArquivoOriginal: binary[key].fileName || `arquivo_${totalArquivos}`,\n      mimeType: binary[key].mimeType || 'application/octet-stream',\n      totalArquivos: 0\n    },\n    binary: {\n      data: binary[key]\n    }\n  });\n}\n\narquivos.forEach(item => {\n  item.json.totalArquivos = totalArquivos;\n});\n\nreturn arquivos.length > 0 ? arquivos : [{ json: { erro: 'Nenhum arquivo encontrado' } }];"
      },
      "id": "1d568441-87f6-4623-b34d-4a9b9771485b",
      "name": "Separar Cada Arquivo",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2240,
        -2224
      ]
    },
    {
      "parameters": {
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": "={{ $json.piFolderId }}",
        "options": {}
      },
      "id": "7b2140e6-30c5-49a1-b811-86d0c173d797",
      "name": "Upload Arquivo no Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -2064,
        -2224
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "676a27f7-ea5a-4a9b-ac9b-53f268cf899a",
      "name": "Aguardar Todos Uploads",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1888,
        -2208
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// PROCESSA UPLOADS BINÁRIOS (<500MB)\nconst todosUploads = $input.all();\nconst submissionData = $items('Validar Submissão')[0].json.body;\nconst pastaPi = $items('Criar Pasta PI')[0].json;\n\nreturn [{\n  json: {\n    n_pi: submissionData.n_pi || 'N/A',\n    cliente: submissionData.cliente || 'N/A',\n    veiculo: submissionData.veiculo || 'N/A',\n    nome: submissionData.nome || 'N/A',\n    email: submissionData.email || 'N/A',\n    telefone: submissionData.telefone || 'N/A',\n    meio: submissionData.meio || 'N/A',\n    observacoes: submissionData.observacoes || '',\n    totalArquivos: todosUploads.length,\n    uploadMethod: 'binary',\n    webViewLink: pastaPi.webViewLink || 'https://drive.google.com/drive/folders/' + pastaPi.id\n  }\n}];"
      },
      "id": "6196edac-30cc-4c8f-9b64-a2f8c5be12a6",
      "name": "Preparar Log Binary",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1712,
        -2208
      ]
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $items('Validar Submissão')[0].json.body.cliente.toUpperCase() }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1OEL4MtYKd5Tg-ZOmsIRG9RQkvfX-xs_s",
          "mode": "list"
        },
        "options": {}
      },
      "id": "ca877a1a-1166-49b6-a445-7440b5f17cdd",
      "name": "Criar Pasta Cliente",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -2864,
        -2112
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account 2"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "checking@teste.com.br",
        "toEmail": "checking@teste.com.br",
        "subject": "=Novo Checking Recebido - PI {{ $json.n_pi }}",
        "html": "=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\n    <title>Notificação de Checking</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background-color: #f7fafc;\">\n    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: #f7fafc;\">\n        <tr>\n            <td align=\"center\" style=\"padding: 20px;\">\n                <table width=\"650\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"max-width: 650px; width: 100%; background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\">\n                    \n                    <tr>\n                        <td height=\"4\" style=\"background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #10b981 40%, #3b82f6 60%, #8b5cf6 80%, #ec4899 100%);\"></td>\n                    </tr>\n                    \n                    <tr>\n                        <td align=\"center\" style=\"padding: 40px 40px 30px 40px; border-bottom: 1px solid #e2e8f0;\">\n                            <h1 style=\"font-family: 'Inter', Arial, sans-serif; font-size: 28px; font-weight: 800; color: #2d3748; margin: 0; text-transform: uppercase; letter-spacing: 2px;\">Novo Checking Recebido</h1>\n                            <p style=\"font-size: 16px; color: #4a5568; margin: 15px 0 0 0; line-height: 1.6;\">Um novo comprovante foi submetido com sucesso.</p>\n                        </td>\n                    </tr>\n                    \n                    <tr>\n                        <td style=\"padding: 40px;\">\n                            <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                <tr>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-right: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Cliente</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.cliente }}</p>\n                                    </td>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-left: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Nº da PI</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.n_pi }}</p>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-right: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Veículo</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.veiculo }}</p>\n                                    </td>\n                                    <td width=\"50%\" valign=\"top\" style=\"padding-left: 15px; padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Data/Hora do Envio</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $now.toFormat('dd/MM/yyyy HH:mm:ss') }}</p>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td colspan=\"2\" style=\"padding-bottom: 30px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Enviado por</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500; line-height: 1.4;\">{{ $json.nome }}</p>\n                                        <p style=\"font-size: 16px; color: #4a5568; margin: 5px 0 0 0; line-height: 1.4;\">{{ $json.email }}</p>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td colspan=\"2\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;\">Observações</p>\n                                        <p style=\"font-size: 16px; color: #2d3748; margin: 0; font-weight: 400; background-color: #f7fafc; padding: 20px; border-radius: 4px; border: 1px solid #e2e8f0; line-height: 1.6;\">{{ $json.observacoes || 'Nenhuma observação foi fornecida.' }}</p>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                    \n                    <tr>\n                        <td align=\"center\" style=\"padding: 0 40px 40px 40px;\">\n                            <a href=\"{{ $json.webViewLink }}\" target=\"_blank\" style=\"background-color: #0033a0; color: #ffffff; padding: 16px 40px; text-decoration: none; border-radius: 4px; font-size: 15px; font-weight: 700; display: inline-block; text-transform: uppercase; letter-spacing: 0.5px; font-family: 'Inter', Arial, sans-serif;\">Acessar Arquivos no Drive</a>\n                        </td>\n                    </tr>\n\n                    <tr>\n                        <td height=\"4\" style=\"background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #10b981 40%, #3b82f6 60%, #8b5cf6 80%, #ec4899 100%);\"></td>\n                    </tr>\n\n                    <tr>\n                        <td align=\"center\" style=\"padding: 40px; background-color: #e5e7eb;\">\n                            <p style=\"font-family: 'Inter', Arial, sans-serif; font-size: 32px; font-weight: 800; color: #2d3748; margin: 0; letter-spacing: 3px;\">ECOSSISTEMA DE COMUNICAÇÃO</p>\n                            <p style=\"font-family: 'Inter', Arial, sans-serif; font-size: 11px; color: #4a5568; margin: 8px 0 0 0; letter-spacing: 4px; text-transform: uppercase; font-weight: 600;\">Comunicação Integrada</p>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n</body>\n</html>",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "aa526e72-c92a-41cf-addf-e2121f6a0a17",
      "name": "Enviar E-mail Notificação",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        -1360,
        -2352
      ],
      "webhookId": "97ee0f28-18f2-4e12-8f98-d402e641553d",
      "credentials": {
        "smtp": {
          "id": "",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": true,\n  \"message\": \"Checking enviado com sucesso!\"\n}",
        "options": {}
      },
      "id": "546ac711-29a7-4dab-bb95-c044a3cf2a9f",
      "name": "Responder Sucesso",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -928,
        -2352
      ]
    },
    {
      "parameters": {
        "fromEmail": "checking@teste.com.br",
        "toEmail": "={{ $('Preparar Log Binary').first().json.email || $('Preparar Log Link').first().json.email }}",
        "subject": "=Checking Recebido - PI {{ $json.n_pi }}",
        "html": "=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Inter', Arial, sans-serif; background-color: #f7fafc;\">\n    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f7fafc; padding: 20px;\">\n        <tr>\n            <td align=\"center\">\n                <table width=\"650\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width: 650px; background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;\">\n                    \n                    <tr>\n                        <td height=\"4\" style=\"background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #10b981 40%, #3b82f6 60%, #8b5cf6 80%, #ec4899 100%);\"></td>\n                    </tr>\n                    \n                    <tr>\n                        <td style=\"padding: 40px; text-align: center; border-bottom: 1px solid #e2e8f0;\">\n                            <h1 style=\"font-size: 28px; font-weight: 800; color: #2d3748; margin: 0; text-transform: uppercase; letter-spacing: 2px;\">CHECKING RECEBIDO</h1>\n                            <p style=\"font-size: 16px; color: #10b981; margin: 15px 0 0 0; font-weight: 600;\">✓ Seu comprovante foi enviado com sucesso!</p>\n                        </td>\n                    </tr>\n                    \n                    <tr>\n                        <td style=\"padding: 40px;\">\n                            <p style=\"font-size: 16px; color: #2d3748; margin: 0 0 25px 0;\">\n                                Olá, <strong>{{ $('Preparar Log Binary').first().json.nome || $('Preparar Log Link').first().json.nome }}</strong>!\n                            </p>\n                            <p style=\"font-size: 16px; color: #2d3748; margin: 0 0 30px 0;\">\n                                Confirmamos o recebimento do seu checking com os seguintes dados:\n                            </p>\n                            \n                            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom: 30px;\">\n                                <tr>\n                                    <td style=\"padding: 15px; background-color: #f7fafc; border-radius: 4px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 5px 0; font-weight: 600; text-transform: uppercase;\">Cliente</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500;\">{{ $('Preparar Log Binary').first().json.cliente || $('Preparar Log Link').first().json.cliente }}</p>\n                                    </td>\n                                </tr>\n                            </table>\n\n                            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom: 30px;\">\n                                <tr>\n                                    <td width=\"50%\" style=\"padding: 15px; background-color: #f7fafc; border-radius: 4px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 5px 0; font-weight: 600; text-transform: uppercase;\">Nº da PI</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500;\">{{ $('Preparar Log Binary').first().json.n_pi || $('Preparar Log Link').first().json.n_pi }}</p>\n                                    </td>\n                                    <td width=\"10\"></td>\n                                    <td width=\"50%\" style=\"padding: 15px; background-color: #f7fafc; border-radius: 4px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 5px 0; font-weight: 600; text-transform: uppercase;\">Veículo</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500;\">{{ $('Preparar Log Binary').first().json.veiculo || $('Preparar Log Link').first().json.veiculo }}</p>\n                                    </td>\n                                </tr>\n                            </table>\n\n                            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom: 30px;\">\n                                <tr>\n                                    <td width=\"50%\" style=\"padding: 15px; background-color: #f7fafc; border-radius: 4px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 5px 0; font-weight: 600; text-transform: uppercase;\">Data/Hora</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500;\">{{ $now.toFormat('dd/MM/yyyy HH:mm') }}</p>\n                                    </td>\n                                    <td width=\"10\"></td>\n                                    <td width=\"50%\" style=\"padding: 15px; background-color: #f7fafc; border-radius: 4px;\">\n                                        <p style=\"font-size: 12px; color: #4a5568; margin: 0 0 5px 0; font-weight: 600; text-transform: uppercase;\">Total de Arquivos</p>\n                                        <p style=\"font-size: 18px; color: #2d3748; margin: 0; font-weight: 500;\">{{ $('Preparar Log Binary').first().json.totalArquivos || $('Preparar Log Link').first().json.totalArquivos }}</p>\n                                    </td>\n                                </tr>\n                            </table>\n\n                            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin: 30px 0;\">\n                                <tr>\n                                    <td style=\"padding: 20px; background-color: #fffbeb; border: 1px solid #fbbf24; border-left: 4px solid #f59e0b; border-radius: 4px;\">\n                                        <p style=\"font-size: 14px; color: #92400e; margin: 0; font-weight: 600;\">\n                                            <strong>⚠️ Importante:</strong> Seus arquivos estão sendo processados pela equipe. Você receberá uma confirmação assim que a análise for concluída.\n                                        </p>\n                                    </td>\n                                </tr>\n                            </table>\n\n                            <p style=\"font-size: 16px; color: #2d3748; margin: 30px 0 0 0;\">\n                                Em caso de dúvidas, entre em contato conosco.\n                            </p>\n                        </td>\n                    </tr>\n\n                    <tr>\n                        <td height=\"4\" style=\"background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #10b981 40%, #3b82f6 60%, #8b5cf6 80%, #ec4899 100%);\"></td>\n                    </tr>\n\n                    <tr>\n                        <td style=\"padding: 40px; background-color: #e5e7eb; text-align: center;\">\n                            <p style=\"font-size: 32px; font-weight: 800; color: #2d3748; margin: 0; letter-spacing: 3px;\">ECOSSISTEMA DE COMUNICAÇÃO</p>\n                            <p style=\"font-size: 11px; color: #4a5568; margin: 8px 0 0 0; letter-spacing: 4px; text-transform: uppercase; font-weight: 600;\">COMUNICAÇÃO INTEGRADA</p>\n                            <p style=\"font-size: 13px; color: #4a5568; margin: 15px 0 0 0;\">checking@teste.com.br</p>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n</body>\n</html>",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "60cc14d0-77cd-474d-a15d-7ec5ae82331f",
      "name": "Enviar E-mail Notificação - Para o Fornecedor",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        -1136,
        -2352
      ],
      "webhookId": "97ee0f28-18f2-4e12-8f98-d402e641553d",
      "credentials": {
        "smtp": {
          "id": "",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "CheckingForm",
        "responseMode": "responseNode",
        "options": {
          "rawBody": "={{ false }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "X-Content-Type-Options",
                "value": "nosniff"
              },
              {
                "name": "X-Frame-Options",
                "value": "DENY"
              },
              {
                "name": "X-XSS-Protection",
                "value": "1; mode=block"
              },
              {
                "name": "Strict-Transport-Security",
                "value": "max-age=31536000"
              }
            ]
          }
        }
      },
      "id": "38ddae88-6bef-4fce-b0db-2f96712b8d0d",
      "name": "Webhook POST",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4512,
        -2384
      ],
      "webhookId": "checking-form-post"
    },
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <!--  CSP RESTRITIVA - Com unsafe-inline para manter JS/CSS inline -->\n    <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://n8n.automation-api.com; frame-ancestors 'none'; base-uri 'self'; form-action 'self';\">\n    <title>Checking teste</title>\n    <link rel=\"icon\" type=\"image/png\" href=\"favicon.png\">\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\n    <style>\n        :root {\n            --primary-color: #0033a0;\n            --cinza-escuro: #1a202c;\n            --cinza-medio: #4a5568;\n            --cinza-claro: #cbd5e0;\n            --cinza-bg: #f7fafc;\n            --branco: #ffffff;\n            --borda: #e2e8f0;\n            --sombra: rgba(0, 0, 0, 0.05);\n        }\n        \n        * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n        }\n        \n        body {\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--cinza-bg);\n            color: var(--cinza-escuro);\n            min-height: 100vh;\n            display: flex;\n            flex-direction: column;\n            line-height: 1.6;\n            -webkit-font-smoothing: antialiased;\n            -moz-osx-font-smoothing: grayscale;\n        }\n        \n        .main-content {\n            width: 100%;\n            display: flex;\n            justify-content: center;\n            padding: 4rem 1.5rem;\n            flex: 1;\n        }\n        \n        .container {\n            max-width: 1200px;\n            width: 100%;\n            background: var(--branco);\n            border-radius: 2px;\n            box-shadow: 0 1px 2px var(--sombra);\n            position: relative;\n            overflow: hidden;\n            padding: 4rem 5rem;\n        }\n        \n        .container::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 8px;\n            background: linear-gradient(90deg, \n                #ef4444 0%, \n                #f59e0b 14.28%, \n                #eab308 28.56%,\n                #10b981 42.84%, \n                #06b6d4 57.12%,\n                #3b82f6 71.4%, \n                #8b5cf6 85.68%, \n                #ec4899 100%\n            );\n        }\n        \n        .header {\n            text-align: center;\n            margin-bottom: 4rem;\n            padding-bottom: 3rem;\n            border-bottom: 1px solid var(--borda);\n        }\n        \n        .header img.logo-teste {\n            max-width: 480px;\n            width: 100%;\n            height: auto;\n            margin-bottom: 2rem;\n        }\n        \n        .header h1 {\n            font-size: 2.5rem;\n            font-weight: 900;\n            color: var(--cinza-escuro);\n            letter-spacing: 4px;\n            text-transform: uppercase;\n            margin: 0;\n        }\n        \n        .attention-box {\n            margin-bottom: 4rem;\n        }\n        \n        .warning-text {\n            background: #fffbeb;\n            border: 1px solid #fbbf24;\n            border-left: 6px solid #f59e0b;\n            color: #92400e;\n            padding: 2rem 2.5rem;\n            border-radius: 0;\n            font-weight: 500;\n            text-align: center;\n            margin-bottom: 2rem;\n            line-height: 1.8;\n            font-size: 0.95rem;\n        }\n        \n        .warning-text strong {\n            font-weight: 800;\n            font-size: 1.05em;\n        }\n        \n        .attention-box img {\n            max-width: 100%;\n            height: auto;\n            display: block;\n            border-radius: 0;\n            border: 1px solid var(--borda);\n        }\n        \n        .form-grid {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 2rem;\n        }\n        \n        .form-group {\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .full-width {\n            grid-column: 1 / -1;\n        }\n        \n        label {\n            font-weight: 700;\n            margin-bottom: 0.6rem;\n            font-size: 0.8rem;\n            color: var(--cinza-escuro);\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        label svg {\n            width: 14px;\n            height: 14px;\n            stroke: var(--cinza-medio);\n            flex-shrink: 0;\n        }\n        \n        input, select, textarea {\n            width: 100%;\n            padding: 1rem 1.25rem;\n            background: var(--branco);\n            border: 2px solid var(--borda);\n            border-radius: 0;\n            font-size: 1rem;\n            font-family: 'Inter', sans-serif;\n            color: var(--cinza-escuro);\n            transition: border-color 0.15s ease, box-shadow 0.15s ease;\n            font-weight: 400;\n        }\n        \n        input:hover, select:hover, textarea:hover {\n            border-color: var(--cinza-claro);\n        }\n        \n        input:focus, select:focus, textarea:focus {\n            outline: none;\n            border-color: var(--primary-color);\n            box-shadow: 0 0 0 3px rgba(0, 51, 160, 0.08);\n        }\n        \n        input::placeholder, textarea::placeholder {\n            color: #a0aec0;\n            font-weight: 400;\n        }\n        \n        input[readonly], .campo-bloqueado {\n            background: #fafafa;\n            border-color: var(--borda);\n            cursor: not-allowed;\n            pointer-events: none;\n            color: var(--cinza-medio);\n            font-weight: 500;\n        }\n        \n        select {\n            cursor: pointer;\n            appearance: none;\n            background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%234a5568' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\");\n            background-repeat: no-repeat;\n            background-position: right 1rem center;\n            background-size: 14px;\n            padding-right: 3rem;\n            font-weight: 500;\n        }\n        \n        textarea {\n            min-height: 140px;\n            resize: vertical;\n            line-height: 1.6;\n        }\n        \n        .upload-container {\n            border: 3px dashed var(--borda);\n            padding: 2.5rem;\n            border-radius: 0;\n            margin-top: 1rem;\n            background: #fafafa;\n        }\n        \n        #upload-placeholder {\n            color: var(--cinza-medio);\n            font-size: 1rem;\n            text-align: center;\n            padding: 2rem;\n            font-weight: 500;\n        }\n        \n        .upload-group {\n            margin-bottom: 2rem;\n            padding: 2rem;\n            background: var(--branco);\n            border-radius: 0;\n            border: 2px solid var(--borda);\n        }\n        \n        .upload-group:last-child {\n            margin-bottom: 0;\n        }\n        \n        .upload-group label {\n            margin-bottom: 1rem;\n        }\n        \n        input[type=\"file\"] {\n            font-size: 0.9rem;\n            padding: 0.75rem;\n            cursor: pointer;\n            border: 2px solid var(--borda);\n        }\n        \n        input[type=\"file\"]::file-selector-button {\n            background: var(--primary-color);\n            color: white;\n            border: none;\n            padding: 0.75rem 1.5rem;\n            border-radius: 0;\n            font-weight: 700;\n            cursor: pointer;\n            margin-right: 1rem;\n            transition: background 0.15s ease;\n            font-size: 0.85rem;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n        \n        input[type=\"file\"]::file-selector-button:hover {\n            background: #00226e;\n        }\n        \n        button[type=\"submit\"] {\n            width: 100%;\n            padding: 1.4rem 2.5rem;\n            background: var(--primary-color);\n            color: white;\n            font-size: 1.1rem;\n            font-weight: 800;\n            border: none;\n            border-radius: 0;\n            cursor: pointer;\n            transition: background 0.15s ease;\n            margin-top: 3rem;\n            text-transform: uppercase;\n            letter-spacing: 2px;\n        }\n        \n        button[type=\"submit\"]:hover {\n            background: #00226e;\n        }\n        \n        button[type=\"submit\"]:disabled {\n            background: var(--cinza-claro);\n            cursor: not-allowed;\n        }\n        \n        .message-box {\n            padding: 1.5rem 2rem;\n            border-radius: 0;\n            margin-top: 2rem;\n            display: none;\n            text-align: center;\n            font-weight: 600;\n            border: 2px solid;\n        }\n        \n        #successMessage {\n            background: #ecfdf5;\n            color: #065f46;\n            border-color: #10b981;\n        }\n        \n        #errorMessage {\n            background: #fef2f2;\n            color: #991b1b;\n            border-color: #ef4444;\n        }\n        \n        #piStatus {\n            font-size: 0.85rem;\n            margin-top: 0.6rem;\n            font-weight: 700;\n            letter-spacing: 0.3px;\n        }\n        \n        .size-info {\n            font-size: 0.85rem;\n            color: var(--cinza-medio);\n            margin-top: 1rem;\n            font-weight: 600;\n            padding: 1rem 1.25rem;\n            background: #fafafa;\n            border-radius: 0;\n            border: 1px solid var(--borda);\n        }\n        \n        .size-info strong {\n            color: var(--primary-color);\n            font-weight: 800;\n        }\n\n        .progress-container {\n            display: none;\n            margin-top: 2rem;\n            padding: 2rem;\n            background: var(--branco);\n            border: 3px solid var(--primary-color);\n            border-radius: 0;\n        }\n\n        .progress-container.active {\n            display: block;\n        }\n\n        .progress-bar-wrapper {\n            width: 100%;\n            height: 40px;\n            background: #fafafa;\n            border-radius: 0;\n            overflow: hidden;\n            position: relative;\n            border: 2px solid var(--borda);\n        }\n\n        .progress-bar {\n            height: 100%;\n            background: var(--primary-color);\n            width: 0%;\n            transition: width 0.3s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            position: relative;\n        }\n\n        .progress-text {\n            position: absolute;\n            width: 100%;\n            text-align: center;\n            font-weight: 800;\n            font-size: 0.9rem;\n            color: var(--cinza-escuro);\n            line-height: 40px;\n            z-index: 1;\n            letter-spacing: 1px;\n        }\n\n        .progress-info {\n            margin-top: 1.25rem;\n            text-align: center;\n            font-size: 0.9rem;\n            color: var(--cinza-medio);\n            font-weight: 600;\n        }\n        \n        .file-counter {\n            font-size: 0.9rem;\n            color: var(--primary-color);\n            font-weight: 700;\n            margin-top: 1.25rem;\n            padding: 1rem 1.5rem;\n            background: #fafafa;\n            border-radius: 0;\n            border: 2px solid var(--borda);\n        }\n        \n        .footer-final {\n            width: 100%;\n            background: #54595F;\n            text-align: center;\n            padding: 4rem 1.5rem;\n            margin-top: auto;\n            position: relative;\n        }\n        \n        .footer-final::before {\n            content: '';\n            position: absolute;\n            width: 100%;\n            height: 8px;\n            background: linear-gradient(90deg, \n                #ef4444 0%, \n                #f59e0b 14.28%, \n                #eab308 28.56%,\n                #10b981 42.84%, \n                #06b6d4 57.12%,\n                #3b82f6 71.4%, \n                #8b5cf6 85.68%, \n                #ec4899 100%\n            );\n            top: 0;\n            left: 0;\n        }\n        \n        .footer-final .logo-principal {\n            font-size: 3rem;\n            font-weight: 900;\n            color: var(--branco);\n            margin-bottom: 0.75rem;\n            letter-spacing: 6px;\n        }\n        \n        .footer-final .subtitulo {\n            font-size: 0.9rem;\n            font-weight: 700;\n            letter-spacing: 5px;\n            text-transform: uppercase;\n            color: rgba(255, 255, 255, 0.7);\n            margin-bottom: 2.5rem;\n        }\n        \n        .footer-final .copyright {\n            font-size: 0.85rem;\n            color: rgba(255, 255, 255, 0.5);\n            margin-top: 2rem;\n            font-weight: 500;\n        }\n        \n        @media (max-width: 768px) {\n            .container {\n                padding: 2.5rem 2rem;\n            }\n            \n            .form-grid {\n                grid-template-columns: 1fr;\n                gap: 1.5rem;\n            }\n            \n            .header h1 {\n                font-size: 1.75rem;\n                letter-spacing: 2px;\n            }\n            \n            .footer-final .logo-principal {\n                font-size: 2.25rem;\n                letter-spacing: 4px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"main-content\">\n        <div class=\"container\">\n            <div class=\"header\">\n                <img src=\"agencia-logo.png\" alt=\"Logo teste\" class=\"logo-teste\">\n                <h1>Checking</h1>\n            </div>\n            \n            <div class=\"attention-box\">\n                <div class=\"warning-text\">\n                    <strong>IMPORTANTE:</strong> Arquivos até <strong>500MB</strong> serão enviados diretamente pelo formulário. Para arquivos maiores, o sistema criará automaticamente uma pasta no Google Drive e você receberá o link por e-mail.<br><br>\n                    O não envio dos relatórios de acordo com especificações acarretará no não pagamento das veiculações.\n                </div>\n                <img src=\"comunicado.jpg\" alt=\"Comunicado sobre relatórios de veiculação\">\n            </div>\n\n            <form id=\"checkingForm\" novalidate>\n                <!-- 🔒 CSRF TOKEN HIDDEN -->\n                <input type=\"hidden\" id=\"csrfToken\" name=\"csrf_token\" value=\"\">\n                \n                <div class=\"form-grid\">\n                    <div class=\"form-group full-width\">\n                        <label for=\"nome\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path><circle cx=\"12\" cy=\"7\" r=\"4\"></circle></svg>\n                            Seu Nome *\n                        </label>\n                        <!-- 🔒 VALIDAÇÃO HTML5 + PATTERN -->\n                        <input \n                            type=\"text\" \n                            id=\"nome\" \n                            name=\"nome\" \n                            required \n                            placeholder=\"Digite seu nome completo\" \n                            maxlength=\"200\"\n                            minlength=\"3\"\n                            pattern=\"[A-Za-zÀ-ÿ\\s]{3,200}\"\n                            autocomplete=\"name\"\n                            aria-required=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"email\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path><polyline points=\"22,6 12,13 2,6\"></polyline></svg>\n                            Seu E-mail *\n                        </label>\n                        <input \n                            type=\"email\" \n                            id=\"email\" \n                            name=\"email\" \n                            required \n                            placeholder=\"seu@email.com\" \n                            maxlength=\"254\"\n                            autocomplete=\"email\"\n                            aria-required=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"telefone\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\"></path></svg>\n                            Seu Telefone *\n                        </label>\n                        <input \n                            type=\"tel\" \n                            id=\"telefone\" \n                            name=\"telefone\" \n                            required \n                            placeholder=\"(00) 00000-0000\" \n                            maxlength=\"20\"\n                            pattern=\"[\\(\\)\\s\\-0-9]+\"\n                            autocomplete=\"tel\"\n                            aria-required=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group full-width\">\n                        <label for=\"pi\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect><line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"9\"></line><line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"></line></svg>\n                            Número da PI *\n                        </label>\n                        <input \n                            type=\"text\" \n                            id=\"pi\" \n                            name=\"n_pi\" \n                            required \n                            placeholder=\"Digite o número da PI\" \n                            maxlength=\"50\"\n                            pattern=\"[a-zA-Z0-9\\-_]+\"\n                            aria-required=\"true\">\n                        <div id=\"piStatus\" role=\"status\" aria-live=\"polite\"></div>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"cliente\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path><polyline points=\"9 22 9 12 15 12 15 22\"></polyline></svg>\n                            Cliente\n                        </label>\n                        <input type=\"text\" id=\"cliente\" name=\"cliente\" readonly aria-readonly=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"campanha\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 19l7-7 3 3-7 7-3-3z\"></path><path d=\"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\"></path><path d=\"M2 2l7.586 7.586\"></path><circle cx=\"11\" cy=\"11\" r=\"2\"></circle></svg>\n                            Campanha\n                        </label>\n                        <input type=\"text\" id=\"campanha\" name=\"campanha\" readonly aria-readonly=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"produto\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"></path><polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"></polyline><line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"></line></svg>\n                            Produto\n                        </label>\n                        <input type=\"text\" id=\"produto\" name=\"produto\" readonly aria-readonly=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"periodo\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect><line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\"></line><line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\"></line><line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\"></line></svg>\n                            Período\n                        </label>\n                        <input type=\"text\" id=\"periodo\" name=\"periodo\" readonly aria-readonly=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"veiculo\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"2\" y=\"7\" width=\"20\" height=\"15\" rx=\"2\" ry=\"2\"></rect><polyline points=\"17 2 12 7 7 2\"></polyline></svg>\n                            Veículo\n                        </label>\n                        <input type=\"text\" id=\"veiculo\" name=\"veiculo\" readonly aria-readonly=\"true\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"meio\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line><path d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"></path></svg>\n                            Meio\n                        </label>\n                        <select id=\"meio\" name=\"meio\" class=\"campo-bloqueado\" aria-readonly=\"true\">\n                            <option value=\"\">Aguardando PI...</option>\n                            <option value=\"AS\">Assessoria de Imprensa</option>\n                            <option value=\"AT\">Ativação</option>\n                            <option value=\"BD\">Busdoor</option>\n                            <option value=\"CI\">Cinema</option>\n                            <option value=\"CN\">Cinema</option>\n                            <option value=\"CS\">Carro de Som</option>\n                            <option value=\"DO\">Digital Out of Home</option>\n                            <option value=\"FL\">Front Light</option>\n                            <option value=\"IA\">Internet-Audio</option>\n                            <option value=\"IB\">Internet-Busca</option>\n                            <option value=\"ID\">Internet-Display e outros</option>\n                            <option value=\"IN\">Internet</option>\n                            <option value=\"IS\">Internet-Social</option>\n                            <option value=\"IV\">Internet-Video</option>\n                            <option value=\"JN\">Jornal</option>\n                            <option value=\"MA\">Mídia Alternativa</option>\n                            <option value=\"ME\">Mídia Externa</option>\n                            <option value=\"MN\">Mídia Interna</option>\n                            <option value=\"MS\">Mídia Social</option>\n                            <option value=\"MT\">Metrô</option>\n                            <option value=\"OD\">Outdoor</option>\n                            <option value=\"OU\">Outros</option>\n                            <option value=\"PY\">Produção/Material Ativação</option>\n                            <option value=\"RA\">Rádio AM</option>\n                            <option value=\"RD\">Rádio</option>\n                            <option value=\"RE\">Revista</option>\n                            <option value=\"RF\">Rádio FM</option>\n                            <option value=\"TA\">TV Assinatura</option>\n                            <option value=\"TO\">Tailor Operações</option>\n                            <option value=\"TV\">Televisão</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"form-group full-width\">\n                        <label for=\"observacoes\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path><polyline points=\"14 2 14 8 20 8\"></polyline><line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line><line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line><polyline points=\"10 9 9 9 8 9\"></polyline></svg>\n                            Observações\n                        </label>\n                        <textarea \n                            id=\"observacoes\" \n                            name=\"observacoes\" \n                            rows=\"4\" \n                            placeholder=\"Adicione observações sobre os comprovantes\" \n                            maxlength=\"2000\"></textarea>\n                    </div>\n                    \n                    <div class=\"form-group full-width\">\n                        <label>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48\"></path></svg>\n                            Comprovantes *\n                        </label>\n                        <div class=\"size-info\">Limite: <strong>500MB</strong> total por envio</div>\n                        <div id=\"upload-area-dinamica\" class=\"upload-container\">\n                            <p id=\"upload-placeholder\">Preencha o número da PI para ver os campos de anexo.</p>\n                            \n                            <!-- DOOH - Digital Out of Home -->\n                            <div class=\"upload-group\" data-meio=\"DO\" style=\"display: none;\">\n                                <label>Relatório Fotográfico de Todos os Pontos *</label>\n                                <input type=\"file\" name=\"relatorio_fotografico_do\" multiple accept=\"image/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"DO\" style=\"display: none;\">\n                                <label>Relatório de Exibições Automatizado *</label>\n                                <input type=\"file\" name=\"relatorio_exibicoes_do\" multiple accept=\".pdf,.xlsx,.xls,.csv\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"DO\" style=\"display: none;\">\n                                <label>Vídeo Diurno *</label>\n                                <input type=\"file\" name=\"video_diurno_do\" multiple accept=\"video/*\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- ME - Mídia Externa MUB -->\n                            <div class=\"upload-group\" data-meio=\"ME\" style=\"display: none;\">\n                                <label>Relatório com Endereço dos Pontos *</label>\n                                <input type=\"file\" name=\"relatorio_enderecos_me\" multiple accept=\".pdf,.xlsx,.xls,.csv\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"ME\" style=\"display: none;\">\n                                <label>Fotos Diurnas (Amostrais) / Noturnas (se iluminado) *</label>\n                                <input type=\"file\" name=\"fotos_pontos_me\" multiple accept=\"image/*,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- MT - Metrô -->\n                            <div class=\"upload-group\" data-meio=\"MT\" style=\"display: none;\">\n                                <label>Relatório com Listagem de Estações/Linhas/Carros *</label>\n                                <input type=\"file\" name=\"relatorio_estacoes_mt\" multiple accept=\".pdf,.xlsx,.xls,.csv\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"MT\" style=\"display: none;\">\n                                <label>Fotos ou Vídeos (Amostrais) *</label>\n                                <input type=\"file\" name=\"fotos_videos_mt\" multiple accept=\"image/*,video/*,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- BD - Busdoor -->\n                            <div class=\"upload-group\" data-meio=\"BD\" style=\"display: none;\">\n                                <label>Relatório Fotográfico de Todos os Ônibus/Carros *</label>\n                                <input type=\"file\" name=\"comprovante_bd\" multiple accept=\"image/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- OD - Outdoor -->\n                            <div class=\"upload-group\" data-meio=\"OD\" style=\"display: none;\">\n                                <label>Relatório Fotográfico com Endereço (Diurno/Noturno se iluminado) *</label>\n                                <input type=\"file\" name=\"comprovante_od\" multiple accept=\"image/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- FL - Front Light -->\n                            <div class=\"upload-group\" data-meio=\"FL\" style=\"display: none;\">\n                                <label>Relatório Fotográfico com Endereço (Diurno/Noturno se iluminado) *</label>\n                                <input type=\"file\" name=\"comprovante_fl\" multiple accept=\"image/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- CS - Carro de Som -->\n                            <div class=\"upload-group\" data-meio=\"CS\" style=\"display: none;\">\n                                <label>Relatório com Roteiro/Locais de Circulação *</label>\n                                <input type=\"file\" name=\"relatorio_roteiro_cs\" multiple accept=\".pdf,.xlsx,.xls\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"CS\" style=\"display: none;\">\n                                <label>Fotos ou Vídeos da Ação *</label>\n                                <input type=\"file\" name=\"fotos_videos_cs\" multiple accept=\"image/*,video/*,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- MI - Mídia Interna -->\n                            <div class=\"upload-group\" data-meio=\"MI\" style=\"display: none;\">\n                                <label>Relatório Fotográfico de Todos os Pontos e Relação de Locais *</label>\n                                <input type=\"file\" name=\"comprovante_mi\" multiple accept=\"image/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- MN - Mídia Interna -->\n                            <div class=\"upload-group\" data-meio=\"MN\" style=\"display: none;\">\n                                <label>Relatório Fotográfico de Todos os Pontos e Relação de Locais *</label>\n                                <input type=\"file\" name=\"comprovante_mn\" multiple accept=\"image/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- RD / RF / RA - Rádio -->\n                            <div class=\"upload-group\" data-meio=\"RD RF RA\" style=\"display: none;\">\n                                <label>Relatório de Veiculação / Em caso de ações de blitz, enviar ZIP com fotos e/ou vídeo *</label>\n                                <input type=\"file\" name=\"comprovante_radio\" multiple accept=\".pdf,.xlsx,.xls,.csv,.zip,image/*,video/*\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- CI / CN - Cinema -->\n                            <div class=\"upload-group\" data-meio=\"CI CN\" style=\"display: none;\">\n                                <label>Relatório de Exibição (Complexo, Número de Salas, Praça) *</label>\n                                <input type=\"file\" name=\"comprovante_cinema\" multiple accept=\".pdf,.xlsx,.xls,.csv\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- JN / RE - Mídia Impressa -->\n                            <div class=\"upload-group\" data-meio=\"JN RE\" style=\"display: none;\">\n                                <label>Material Físico (preferencialmente) + PDF/Foto do Título com Material Veiculado *</label>\n                                <input type=\"file\" name=\"comprovante_impresso\" multiple accept=\"image/*,.pdf\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- AT - Ativação -->\n                            <div class=\"upload-group\" data-meio=\"AT\" style=\"display: none;\">\n                                <label>Relatório Fotográfico ou Vídeos + Detalhamento das Ações *</label>\n                                <input type=\"file\" name=\"comprovante_ativacao\" multiple accept=\"image/*,video/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- PY - Produção/Material Ativação -->\n                            <div class=\"upload-group\" data-meio=\"PY\" style=\"display: none;\">\n                                <label>Fotos do Material Produzido *</label>\n                                <input type=\"file\" name=\"fotos_material_py\" multiple accept=\"image/*,.pdf,.zip\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"PY\" style=\"display: none;\">\n                                <label>Nota Fiscal ou Comprovante de Entrega *</label>\n                                <input type=\"file\" name=\"nota_fiscal_py\" multiple accept=\".pdf,image/*\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- MA - Mídia Alternativa -->\n                            <div class=\"upload-group\" data-meio=\"MA\" style=\"display: none;\">\n                                <label>Relatório Fotográfico ou Vídeos *</label>\n                                <input type=\"file\" name=\"relatorio_foto_ma\" multiple accept=\"image/*,video/*,.zip\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"MA\" style=\"display: none;\">\n                                <label>Descrição da Ação Realizada *</label>\n                                <input type=\"file\" name=\"descricao_acao_ma\" multiple accept=\".pdf,.docx,.txt\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- TV / TA / TO - Televisão -->\n                            <div class=\"upload-group\" data-meio=\"TV TA TO\" style=\"display: none;\">\n                                <label>Relatório de Veiculação Automatizado *</label>\n                                <input type=\"file\" name=\"comprovante_tv\" multiple accept=\".pdf,.xlsx,.xls,.csv\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- IN / IA / IB / ID / IS / IV / MS - Internet e Mídias Sociais -->\n                            <div class=\"upload-group\" data-meio=\"IN IA IB ID IS IV MS\" style=\"display: none;\">\n                                <label>Relatório de Veiculação + Prints das Peças *</label>\n                                <input type=\"file\" name=\"comprovante_internet\" multiple accept=\"image/*,.pdf,.xlsx,.xls,.csv,.zip\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- AS - Assessoria de Imprensa -->\n                            <div class=\"upload-group\" data-meio=\"AS\" style=\"display: none;\">\n                                <label>Clipping de Mídia (Matérias Publicadas) *</label>\n                                <input type=\"file\" name=\"clipping_as\" multiple accept=\".pdf,image/*,.zip\" data-max-size=\"104857600\">\n                            </div>\n                            <div class=\"upload-group\" data-meio=\"AS\" style=\"display: none;\">\n                                <label>Relatório de Resultados (Alcance, Valor de Mídia) *</label>\n                                <input type=\"file\" name=\"relatorio_resultados_as\" multiple accept=\".pdf,.xlsx,.xls\" data-max-size=\"104857600\">\n                            </div>\n\n                            <!-- OU - Outros -->\n                            <div class=\"upload-group\" data-meio=\"OU\" style=\"display: none;\">\n                                <label>Comprovante de Veiculação *</label>\n                                <input type=\"file\" name=\"comprovante_generico\" multiple accept=\"image/*,.pdf,.xlsx,.xls,.csv,.zip,video/*\" data-max-size=\"104857600\">\n                            </div>\n                        </div>\n                        <div class=\"file-counter\" id=\"fileCounter\" style=\"display: none;\"></div>\n                    </div>\n\n                    <div class=\"form-group full-width\">\n                        <div class=\"progress-container\" id=\"progressContainer\">\n                            <div class=\"progress-bar-wrapper\">\n                                <div class=\"progress-text\" id=\"progressText\">0%</div>\n                                <div class=\"progress-bar\" id=\"progressBar\"></div>\n                            </div>\n                            <div class=\"progress-info\" id=\"progressInfo\">Preparando envio...</div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"form-group full-width\">\n                        <button type=\"submit\">Enviar Checking</button>\n                    </div>\n                </div>\n            </form>\n            \n            <div class=\"message-box\" id=\"successMessage\" role=\"alert\"></div>\n            <div class=\"message-box\" id=\"errorMessage\" role=\"alert\"></div>\n        </div>\n    </div>\n    \n    <footer class=\"footer-final\">\n        <div class=\"logo-principal\">ECOSSISTEMA DE COMUNICAÇÃO</div>\n        <div class=\"subtitulo\">COMUNICAÇÃO INTEGRADA</div>\n        <p class=\"copyright\">&copy; 2025 teste - Todos os direitos reservados</p>\n    </footer>\n\n<script>\n    (function () {\n        'use strict';\n        \n        // ========================================\n        //  FUNÇÕES DE SANITIZAÇÃO E SEGURANÇA\n        // ========================================\n        \n        /**\n         * Escapa HTML para prevenir XSS\n         */\n        function escapeHtml(text) {\n            const map = {\n                '&': '&amp;',\n                '<': '&lt;',\n                '>': '&gt;',\n                '\"': '&quot;',\n                \"'\": '&#039;',\n                '/': '&#x2F;'\n            };\n            return String(text).replace(/[&<>\"'/]/g, s => map[s]);\n        }\n\n        /**\n         * Remove caracteres perigosos de nomes de arquivo\n         */\n        function sanitizeFilename(filename) {\n            return filename\n                .replace(/[^a-zA-Z0-9._-]/g, '_')\n                .substring(0, 255);\n        }\n\n        /**\n         * Valida e sanitiza entrada de texto\n         */\n        function sanitizeInput(input, maxLength = 500) {\n            if (!input) return '';\n            return escapeHtml(String(input).trim().substring(0, maxLength));\n        }\n\n        /**\n         * Valida email com regex seguro\n         */\n        function isValidEmail(email) {\n            const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n            return regex.test(email) && email.length <= 254;\n        }\n\n        /**\n         * Valida número de PI (apenas alfanumérico)\n         */\n        function isValidPI(pi) {\n            const regex = /^[a-zA-Z0-9-_]{1,50}$/;\n            return regex.test(pi);\n        }\n\n        /**\n         * Valida telefone brasileiro\n         */\n        function isValidPhone(phone) {\n            const cleanPhone = phone.replace(/\\D/g, '');\n            return cleanPhone.length >= 10 && cleanPhone.length <= 11;\n        }\n\n        /**\n         * Valida tipo MIME de arquivo\n         */\n        function isValidFileType(file) {\n            const allowedTypes = [\n                'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp',\n                'application/pdf',\n                'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n                'text/csv',\n                'application/zip', 'application/x-zip-compressed',\n                'video/mp4', 'video/mpeg', 'video/quicktime', 'video/x-msvideo'\n            ];\n            return allowedTypes.includes(file.type);\n        }\n\n        /**\n         * Seta conteúdo de forma segura (previne XSS)\n         */\n        function setTextContent(element, text) {\n            if (element) {\n                element.textContent = sanitizeInput(text);\n            }\n        }\n\n        // ========================================\n        // 🎯 CONSTANTES E ELEMENTOS DO DOM\n        // ========================================\n        \n        const MAX_SIZE = 500 * 1024 * 1024; // 500MB\n        const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB por arquivo\n        \n        const form = document.getElementById('checkingForm');\n        const piInput = document.getElementById('pi');\n        const piStatus = document.getElementById('piStatus');\n        const clienteInput = document.getElementById('cliente');\n        const campanhaInput = document.getElementById('campanha');\n        const produtoInput = document.getElementById('produto');\n        const periodoInput = document.getElementById('periodo');\n        const veiculoInput = document.getElementById('veiculo');\n        const meioSelect = document.getElementById('meio');\n        const successMessage = document.getElementById('successMessage');\n        const errorMessage = document.getElementById('errorMessage');\n        const submitButton = form.querySelector('button[type=\"submit\"]');\n        const uploadArea = document.getElementById('upload-area-dinamica');\n        const uploadPlaceholder = document.getElementById('upload-placeholder');\n        const allUploadGroups = uploadArea.querySelectorAll('.upload-group');\n        const fileCounter = document.getElementById('fileCounter');\n        const progressContainer = document.getElementById('progressContainer');\n        const progressBar = document.getElementById('progressBar');\n        const progressText = document.getElementById('progressText');\n        const progressInfo = document.getElementById('progressInfo');\n\n        let piFetchController = null;\n        teste\n\n        // ========================================\n        // FUNÇÕES DE UI\n        // ========================================\n\n        function showMessage(element, message, isHtml = false) {\n            if (isHtml) {\n                element.innerHTML = message;\n            } else {\n                setTextContent(element, message);\n            }\n            element.style.display = 'block';\n        }\n\n        function clearMessages() {\n            successMessage.style.display = 'none';\n            errorMessage.style.display = 'none';\n        }\n        \n        function updateProgress(percent, info) {\n            progressBar.style.width = percent + '%';\n            setTextContent(progressText, percent + '%');\n            if (info) {\n                progressInfo.innerHTML = info; // Permitido apenas para formatação de tamanho\n            }\n        }\n\n        function showProgress() {\n            progressContainer.classList.add('active');\n            updateProgress(0, 'Iniciando envio...');\n        }\n\n        function hideProgress() {\n            progressContainer.classList.remove('active');\n            updateProgress(0, '');\n        }\n\n        function formatFileSize(bytes) {\n            if (bytes === 0) return '0 Bytes';\n            const k = 1024;\n            const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n            const i = Math.floor(Math.log(bytes) / Math.log(k));\n            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n        }\n\n        function checkTotalFileSize() {\n            let totalSize = 0;\n            let totalFiles = 0;\n            \n            const visibleFileInputs = uploadArea.querySelectorAll('.upload-group[style*=\"display: block\"] input[type=\"file\"]');\n            visibleFileInputs.forEach(input => {\n                if (input.files) {\n                    for (let i = 0; i < input.files.length; i++) {\n                        const file = input.files[i];\n                        \n                        // Validação de tipo de arquivo\n                        if (!isValidFileType(file)) {\n                            showMessage(errorMessage, 'Tipo de arquivo não permitido: ' + escapeHtml(file.name));\n                            input.value = '';\n                            return;\n                        }\n                        \n                        // Validação de tamanho individual\n                        if (file.size > MAX_FILE_SIZE) {\n                            showMessage(errorMessage, 'Arquivo muito grande (máx 100MB por arquivo): ' + escapeHtml(file.name));\n                            input.value = '';\n                            return;\n                        }\n                        \n                        totalSize += file.size;\n                        totalFiles++;\n                    }\n                }\n            });\n\n            if (totalFiles > 0) {\n                const sizeText = totalFiles + ' arquivo(s) - ' + formatFileSize(totalSize);\n                setTextContent(fileCounter, sizeText);\n                fileCounter.style.display = 'block';\n                \n                if (totalSize > MAX_SIZE) {\n                    showMessage(errorMessage, 'Tamanho total excede 500MB. Total: ' + formatFileSize(totalSize));\n                    return false;\n                }\n            } else {\n                fileCounter.style.display = 'none';\n            }\n            \n            return true;\n        }\n\n        uploadArea.addEventListener('change', function(e) {\n            if (e.target.type === 'file') {\n                clearMessages();\n                checkTotalFileSize();\n            }\n        });\n        \n        function resetPIFields() {\n            clienteInput.value = '';\n            campanhaInput.value = '';\n            produtoInput.value = '';\n            periodoInput.value = '';\n            veiculoInput.value = '';\n            meioSelect.value = '';\n            atualizarCamposDeAnexo('');\n        }\n\n        function atualizarCamposDeAnexo(meio) {\n            let algumCampoVisivel = false;\n            \n            allUploadGroups.forEach(group => {\n                const meiosDoGrupo = group.dataset.meio.split(' ');\n                const input = group.querySelector('input[type=\"file\"]');\n                \n                if (meio && meiosDoGrupo.includes(meio)) {\n                    group.style.display = 'block';\n                    if (input) {\n                        input.required = true;\n                        input.disabled = false;\n                    }\n                    algumCampoVisivel = true;\n                } else {\n                    group.style.display = 'none';\n                    if (input) {\n                        input.required = false;\n                        input.value = '';\n                    }\n                }\n            });\n            \n            uploadPlaceholder.style.display = algumCampoVisivel ? 'none' : 'block';\n            fileCounter.style.display = 'none';\n        }\n\n        // ========================================\n        //  BUSCA DE PI (COM SANITIZAÇÃO)\n        // ========================================\n\n        async function buscarDadosPI(npi) {\n            if (!npi) {\n                resetPIFields();\n                setTextContent(piStatus, '');\n                return;\n            }\n            \n            // Validação do número da PI\n            if (!isValidPI(npi)) {\n                setTextContent(piStatus, 'Formato de PI inválido');\n                piStatus.style.color = '#ef4444';\n                resetPIFields();\n                return;\n            }\n            \n            if (piFetchController) piFetchController.abort();\n            \n            piFetchController = new AbortController();\n            setTextContent(piStatus, 'Buscando...');\n            piStatus.style.color = '#4a5568';\n            clearMessages();\n            resetPIFields();\n\n            try {\n                const payload = {\n                    action: 'buscar_pi',\n                    n_pi: sanitizeInput(npi, 50) // Sanitiza antes de enviar\n                };\n\n                const response = await fetch(webhookUrl, {\n                    method: 'POST',\n                    headers: { \n                        'Content-Type': 'application/json',\n                        'X-Requested-With': 'XMLHttpRequest' // Proteção CSRF básica\n                    },\n                    body: JSON.stringify(payload),\n                    signal: piFetchController.signal,\n                });\n                \n                if (!response.ok) {\n                    throw new Error('Erro na comunicação');\n                }\n                \n                const data = await response.json();\n\n                if (data.success) {\n                    setTextContent(piStatus, 'Dados carregados com sucesso.');\n                    piStatus.style.color = '#10b981';\n                    \n                    // Detecção automática de Mídia Externa\n                    let meioFinal = data.meio || '';\n                    \n                    const palavrasChaveME = [\n                        'outdoor', 'mub', 'busdoor', 'taxidoor', \n                        'painel', 'placa', 'frontlight', 'backlight',\n                        'empena', 'topo', 'lateral', 'fachada',\n                        'billboard', 'testeira', 'totem',\n                        'abrigo', 'relogio', 'mobiliario urbano'\n                    ];\n                    \n                    const veiculoLower = (data.veiculo || '').toLowerCase();\n                    const isMidiaExterna = palavrasChaveME.some(termo => veiculoLower.includes(termo));\n                    \n                    if (isMidiaExterna && (!meioFinal || meioFinal === '')) {\n                        meioFinal = 'ME';\n                    }\n                    \n                    // Preenche campos COM SANITIZAÇÃO\n                    clienteInput.value = sanitizeInput(data.cliente, 200);\n                    campanhaInput.value = sanitizeInput(data.campanha, 200);\n                    produtoInput.value = sanitizeInput(data.produto, 200);\n                    periodoInput.value = sanitizeInput(data.periodo, 100);\n                    veiculoInput.value = sanitizeInput(data.veiculo, 200);\n                    meioSelect.value = meioFinal;\n                    \n                    atualizarCamposDeAnexo(meioFinal);\n                    \n                } else {\n                    setTextContent(piStatus, data.error || 'PI não encontrada');\n                    piStatus.style.color = '#ef4444';\n                    resetPIFields();\n                }\n            } catch (error) {\n                if (error.name !== 'AbortError') {\n                    setTextContent(piStatus, 'Erro na busca');\n                    piStatus.style.color = '#ef4444';\n                    resetPIFields();\n                }\n            }\n        }\n        \n        // ========================================\n        //  SUBMISSÃO DO FORMULÁRIO (COM VALIDAÇÃO)\n        // ========================================\n        \n        form.addEventListener('submit', async function (e) {\n            e.preventDefault();\n            clearMessages();\n            hideProgress();\n\n            // Validação de campos obrigatórios\n            const nome = document.getElementById('nome').value.trim();\n            const email = document.getElementById('email').value.trim();\n            const telefone = document.getElementById('telefone').value.trim();\n            const npi = document.getElementById('pi').value.trim();\n\n            if (!nome || nome.length < 3) {\n                showMessage(errorMessage, 'Nome inválido (mínimo 3 caracteres)');\n                return;\n            }\n\n            if (!isValidEmail(email)) {\n                showMessage(errorMessage, 'E-mail inválido');\n                return;\n            }\n\n            if (!isValidPhone(telefone)) {\n                showMessage(errorMessage, 'Telefone inválido');\n                return;\n            }\n\n            if (!isValidPI(npi)) {\n                showMessage(errorMessage, 'Número de PI inválido');\n                return;\n            }\n\n            // Validação de anexos obrigatórios\n            let camposAnexoObrigatoriosPreenchidos = true;\n            const camposAnexoVisiveis = uploadArea.querySelectorAll('.upload-group[style*=\"display: block\"] input[type=\"file\"]');\n            \n            camposAnexoVisiveis.forEach(input => {\n                if (input.required && input.files.length === 0) {\n                    camposAnexoObrigatoriosPreenchidos = false;\n                }\n            });\n\n            if (!camposAnexoObrigatoriosPreenchidos) {\n                showMessage(errorMessage, 'Anexe todos os comprovantes obrigatórios');\n                return;\n            }\n\n            // Validação de tamanho total\n            if (!checkTotalFileSize()) {\n                return;\n            }\n\n            const originalButtonText = submitButton.textContent;\n            submitButton.textContent = 'Enviando...';\n            submitButton.disabled = true;\n            showProgress();\n            \n            const formData = new FormData();\n            \n            // Adiciona dados COM SANITIZAÇÃO\n            formData.append('action', 'submissao_form');\n            formData.append('nome', sanitizeInput(nome, 200));\n            formData.append('email', sanitizeInput(email, 254));\n            formData.append('telefone', sanitizeInput(telefone, 20));\n            formData.append('n_pi', sanitizeInput(npi, 50));\n            formData.append('cliente', sanitizeInput(clienteInput.value, 200));\n            formData.append('campanha', sanitizeInput(campanhaInput.value, 200));\n            formData.append('produto', sanitizeInput(produtoInput.value, 200));\n            formData.append('periodo', sanitizeInput(periodoInput.value, 100));\n            formData.append('veiculo', sanitizeInput(veiculoInput.value, 200));\n            formData.append('meio', sanitizeInput(meioSelect.value, 10));\n            formData.append('observacoes', sanitizeInput(document.getElementById('observacoes').value, 2000));\n            formData.append('upload_method', 'binary');\n            \n            let totalSize = 0;\n            const allFileInputs = form.querySelectorAll('input[type=\"file\"]');\n            \n            allFileInputs.forEach(input => {\n                if (input.files.length > 0) {\n                    for (let i = 0; i < input.files.length; i++) {\n                        const file = input.files[i];\n                        \n                        // Validação final de segurança\n                        if (!isValidFileType(file)) {\n                            showMessage(errorMessage, 'Tipo de arquivo não permitido');\n                            submitButton.textContent = originalButtonText;\n                            submitButton.disabled = false;\n                            hideProgress();\n                            return;\n                        }\n                        \n                        formData.append(input.name, file);\n                        totalSize += file.size;\n                    }\n                }\n            });\n            \n            updateProgress(10, 'Preparando <strong>' + formatFileSize(totalSize) + '</strong> para upload...');\n\n            try {\n                const xhr = new XMLHttpRequest();\n                \n                xhr.upload.addEventListener('progress', function(e) {\n                    if (e.lengthComputable) {\n                        const percentComplete = Math.round((e.loaded / e.total) * 100);\n                        const loaded = formatFileSize(e.loaded);\n                        const total = formatFileSize(e.total);\n                        updateProgress(percentComplete, 'Enviando: <strong>' + loaded + '</strong> de <strong>' + total + '</strong>');\n                    }\n                });\n\n                xhr.addEventListener('load', function() {\n                    try {\n                        const result = JSON.parse(xhr.responseText);\n                        \n                        if (xhr.status !== 200 || !result.success) {\n                            throw new Error(result.message || 'Erro no envio');\n                        }\n                        \n                        updateProgress(100, 'Envio concluído!');\n                        setTimeout(() => {\n                            showMessage(successMessage, 'Checking enviado com sucesso!');\n                            form.reset();\n                            setTextContent(piStatus, '');\n                            resetPIFields();\n                            fileCounter.style.display = 'none';\n                            hideProgress();\n                        }, 1000);\n                        \n                    } catch (error) {\n                        hideProgress();\n                        showMessage(errorMessage, 'Erro ao processar resposta');\n                    } finally {\n                        submitButton.textContent = originalButtonText;\n                        submitButton.disabled = false;\n                    }\n                });\n\n                xhr.addEventListener('error', function() {\n                    hideProgress();\n                    showMessage(errorMessage, 'Erro na conexão');\n                    submitButton.textContent = originalButtonText;\n                    submitButton.disabled = false;\n                });\n\n                xhr.addEventListener('timeout', function() {\n                    hideProgress();\n                    showMessage(errorMessage, 'Tempo esgotado');\n                    submitButton.textContent = originalButtonText;\n                    submitButton.disabled = false;\n                });\n\n                xhr.open('POST', webhookUrl);\n                xhr.timeout = 1800000;\n                xhr.send(formData);\n                \n            } catch (error) {\n                hideProgress();\n                showMessage(errorMessage, 'Erro inesperado');\n                submitButton.textContent = originalButtonText;\n                submitButton.disabled = false;\n            }\n        });\n        \n        // ========================================\n        //  DEBOUNCE NA BUSCA DE PI\n        // ========================================\n        \n        let debounceTimeout;\n        piInput.addEventListener('input', () => {\n            clearTimeout(debounceTimeout);\n            debounceTimeout = setTimeout(() => { \n                buscarDadosPI(piInput.value.trim()); \n            }, 500);\n        });\n\n    })();\n</script>\n</body>\n</html>"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        -4928,
        -2000
      ],
      "id": "13ab3076-e21d-4b6b-af87-5de15f8ae520",
      "name": "Formulario Cheking"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "65dfbee2-f521-4fab-be03-ce0d7b6b06da",
      "name": "Responder Dashboard",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -5136,
        -2368
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": 1807228652,
          "mode": "list",
          "cachedResultName": "Log_Checkings",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iwUay2RE8k1PumivMbEjuzIyw4CBaktJ2YPsR1iwe_Q/edit#gid=1807228652"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "specifyRangeA1",
              "range": "A:H"
            }
          }
        }
      },
      "id": "8089e1ec-b099-4483-9795-a6cdd795fe68",
      "name": "Google Sheets - Ler Dados",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -5792,
        -2368
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": "ADAdmin N8N"
        }
      }
    },
    {
      "parameters": {
        "path": "painel-checking",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "62f1c10a-70b2-4c57-96aa-7d91a3d35ea8",
      "name": "Webhook - Painel Checking",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -5984,
        -2368
      ],
      "webhookId": "painel-checking"
    },
    {
      "parameters": {
        "jsCode": "function parseData(input) {\n    if (!input) return null;\n    let dateObj = null;\n    \n    if (typeof input === 'number') {\n        dateObj = new Date((input - 25569) * 86400 * 1000);\n    } else if (typeof input === 'string') {\n        const t = input.trim();\n        \n        const brFormat = t.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})(?:\\s+(\\d{1,2}):(\\d{1,2})(?::(\\d{1,2}))?)?/);\n        if (brFormat) {\n            const day = parseInt(brFormat[1]);\n            const month = parseInt(brFormat[2]) - 1;\n            const year = parseInt(brFormat[3]);\n            const hour = parseInt(brFormat[4]) || 0;\n            const min = parseInt(brFormat[5]) || 0;\n            const sec = parseInt(brFormat[6]) || 0;\n            dateObj = new Date(year, month, day, hour, min, sec);\n        } else {\n            const d = new Date(t);\n            if (!isNaN(d.getTime())) dateObj = d;\n        }\n    } else if (input instanceof Date) {\n        dateObj = input;\n    }\n    \n    if (dateObj && !isNaN(dateObj.getTime())) {\n        const y = dateObj.getFullYear();\n        const m = String(dateObj.getMonth() + 1).padStart(2, '0');\n        const d = String(dateObj.getDate()).padStart(2, '0');\n        const h = String(dateObj.getHours()).padStart(2, '0');\n        const min = String(dateObj.getMinutes()).padStart(2, '0');\n        return { \n            iso: `${y}-${m}-${d}`, \n            display: `${d}/${m}/${y} ${h}:${min}`,\n            dateObj: dateObj,\n            ts: dateObj.getTime()\n        };\n    }\n    return null;\n}\n\nfunction getBrazilDateTime() {\n    const now = new Date();\n    const brazilOffset = -3 * 60;\n    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);\n    const brazilTime = new Date(utc + (brazilOffset * 60000));\n    return brazilTime;\n}\n\nconst rawData = $input.all().map(item => item.json);\nconst now = getBrazilDateTime();\n\n// Filtrar dados válidos\nconst validData = rawData.filter(row => {\n    const hasClient = row['Cliente'] || row['cliente'];\n    const hasPI = row['PI'] || row['pi'] || row['N_PI'] || row['n_pi'];\n    const hasStatus = row['Status'] || row['status'];\n    return hasClient || hasPI || hasStatus;\n});\n\n// 1. Descobrir a data mais antiga para montar a timeline correta\nlet minTimestamp = now.getTime();\n// Vamos usar uma margem de segurança de 1 ano para evitar datas erradas (ex: 1970)\nconst oneYearAgo = now.getTime() - (365 * 24 * 60 * 60 * 1000); \n\nconst preparedData = validData.map(row => {\n    const rawDate = row['Data'] || row['Timestamp'] || row['timestamp'] || row['Carimbo de data/hora'] || row['data'];\n    const dt = parseData(rawDate);\n    \n    if (dt && dt.ts < minTimestamp && dt.ts > oneYearAgo) {\n        minTimestamp = dt.ts;\n    }\n    \n    return { \n        row, \n        dt,\n        client: (row['Cliente'] || row['cliente'] || 'N/A').trim(),\n        status: (row['Status'] || row['status'] || 'Unknown').trim()\n    };\n});\n\n// Calcular quantos dias de histórico temos (mínimo 30 dias por padrão)\nconst daysDiff = Math.ceil((now.getTime() - minTimestamp) / (1000 * 60 * 60 * 24));\nconst historyDays = Math.max(daysDiff, 30); \n\nconst stats = { total: 0, success: 0, error: 0, byDate: {}, byClient: {}, clientTimeline: {} };\nconst timelineKeys = [];\n\n// Gerar timeline dinâmica baseada no histórico real\nfor (let i = historyDays; i >= 0; i--) {\n    const d = new Date(now);\n    d.setDate(now.getDate() - i);\n    const iso = d.toISOString().split('T')[0];\n    const display = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}`;\n    timelineKeys.push({ iso, display });\n    stats.byDate[iso] = 0;\n}\n\n// Processar estatísticas\nfor (const item of preparedData) {\n    stats.total++;\n    const s = item.status.toLowerCase();\n    \n    if (s.includes('enviado') || s.includes('sucesso')) stats.success++;\n    else if (s.includes('erro') || s.includes('falha')) stats.error++;\n    \n    if (!stats.byClient[item.client]) stats.byClient[item.client] = { nome: item.client, total: 0 };\n    stats.byClient[item.client].total++;\n    \n    if (item.dt) {\n        // Timeline do cliente\n        if (!stats.clientTimeline[item.client]) stats.clientTimeline[item.client] = {};\n        if (!stats.clientTimeline[item.client][item.dt.iso]) stats.clientTimeline[item.client][item.dt.iso] = 0;\n        stats.clientTimeline[item.client][item.dt.iso]++;\n        \n        // Timeline geral (se a data existir no range gerado)\n        if (stats.byDate[item.dt.iso] !== undefined) stats.byDate[item.dt.iso]++;\n    }\n}\n\nconst allClients = Object.values(stats.byClient).sort((a, b) => b.total - a.total);\n\nfunction stringToColor(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);\n    const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();\n    return '#' + '00000'.substring(0, 6 - c.length) + c;\n}\n\nconst datasetsTimeline = allClients.map((c) => {\n    const colorHex = stringToColor(c.nome);\n    const dataPoints = timelineKeys.map(t => (stats.clientTimeline[c.nome] && stats.clientTimeline[c.nome][t.iso]) || 0);\n    return { \n        label: c.nome, \n        data: dataPoints, \n        borderColor: colorHex, \n        backgroundColor: colorHex + '33', \n        borderWidth: 2, \n        tension: 0.4, \n        fill: true, \n        pointRadius: 0, \n        pointHoverRadius: 6 \n    };\n});\n\nconst top6 = allClients.slice(0, 6);\nconst radarData = { labels: top6.map(c => c.nome), data: top6.map(c => c.total) };\n\n// Preparar tabela de logs\nconst processedLogs = preparedData.map(item => {\n    const r = item.row;\n    let driveLink = r['webViewLink'] || r['WebViewLink'] || r['driveLink'] || r['DriveLink'] || '';\n    \n    return {\n        timestamp: item.dt ? item.dt.display : 'N/A',\n        dateObj: item.dt ? item.dt.dateObj : new Date(0),\n        cliente: item.client,\n        pi: r['PI'] || r['pi'] || r['N_PI'] || r['n_pi'] || 'N/A',\n        veiculo: r['Veículo'] || r['veiculo'] || r['Veiculo'] || 'N/A',\n        status: item.status,\n        driveLink: driveLink\n    };\n});\n\nprocessedLogs.sort((a, b) => b.dateObj - a.dateObj);\n\nconst logs = processedLogs.map(log => ({\n    timestamp: log.timestamp,\n    cliente: log.cliente,\n    pi: log.pi,\n    veiculo: log.veiculo,\n    status: log.status,\n    driveLink: log.driveLink\n}));\n\nconst lastDateKey = timelineKeys[timelineKeys.length - 1].iso;\nconst atualizadoEm = `${String(now.getDate()).padStart(2,'0')}/${String(now.getMonth()+1).padStart(2,'0')}/${now.getFullYear()}, ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;\n\nreturn [{\n    json: {\n        metricas: {\n            total: stats.total,\n            taxaSucesso: stats.total > 0 ? ((stats.success / stats.total) * 100).toFixed(1) : '0',\n            erros: stats.error,\n            checkingsHoje: stats.byDate[lastDateKey] || 0,\n            enviados: stats.success,\n            mediaMovel: (stats.total / (historyDays || 1)).toFixed(1),\n            diasHistorico: historyDays\n        },\n        graficos: {\n            timeline: { labels: timelineKeys.map(t => t.display), datasets: datasetsTimeline },\n            radar: radarData\n        },\n        tabelas: { logs },\n        metadata: { atualizadoEm: atualizadoEm }\n    }\n}];"
      },
      "id": "d20714cb-9631-4511-8609-823167ab7ce0",
      "name": "Processar Dados",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5584,
        -2368
      ]
    },
    {
      "parameters": {
        "jsCode": "const dashboardData = $input.first().json;\nconst historyDays = dashboardData.metricas.diasHistorico || 30;\n\nconst html = `\n<!DOCTYPE html>\n<html class=\"light\" lang=\"pt-BR\">\n<head>\n    <meta charset=\"utf-8\"/>\n    <meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n    <title>Painel de Checking | Ecossistema de Comunicação</title>\n    \n    <link href=\"https://fonts.googleapis.com\" rel=\"preconnect\"/>\n    <link crossorigin=\"\" href=\"https://fonts.gstatic.com\" rel=\"preconnect\"/>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap\" rel=\"stylesheet\"/>\n    <link href=\"https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap\" rel=\"stylesheet\"/>\n    <link href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap\" rel=\"stylesheet\"/>\n    \n    <script src=\"https://cdn.tailwindcss.com?plugins=forms,container-queries\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    \n    <script>\n        tailwind.config = {\n            darkMode: \"class\",\n            theme: {\n                extend: {\n                    colors: {\n                        \"primary\": \"#137fec\",\n                        \"primary-dark\": \"#0d5fb8\",\n                        \"background-light\": \"#f6f7f8\",\n                        \"background-dark\": \"#000000\",\n                        \"card-dark\": \"#0a0a0a\",\n                        \"text-main\": \"#111418\",\n                        \"text-secondary\": \"#617589\",\n                        \"border-light\": \"#dbe0e6\",\n                        \"success\": \"#078838\",\n                        \"error\": \"#e73908\",\n                        \"warning\": \"#f59e0b\",\n                    },\n                    fontFamily: {\n                        \"display\": [\"Inter\", \"sans-serif\"],\n                        \"mono\": [\"JetBrains Mono\", \"monospace\"]\n                    },\n                    borderRadius: {\n                        \"DEFAULT\": \"0.25rem\", \n                        \"lg\": \"0.5rem\", \n                        \"xl\": \"0.75rem\", \n                        \"2xl\": \"1rem\",\n                        \"full\": \"9999px\"\n                    },\n                },\n            },\n        }\n    </script>\n    \n    <script>\n        function toggleDarkMode() {\n            const html = document.documentElement;\n            if (html.classList.contains('dark')) {\n                html.classList.remove('dark');\n                html.classList.add('light');\n                localStorage.setItem('theme', 'light');\n            } else {\n                html.classList.add('dark');\n                html.classList.remove('light');\n                localStorage.setItem('theme', 'dark');\n            }\n            if (window.renderCharts) window.renderCharts();\n        }\n        \n        document.addEventListener('DOMContentLoaded', () => {\n            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {\n                document.documentElement.classList.add('dark');\n                document.documentElement.classList.remove('light');\n            } else {\n                document.documentElement.classList.remove('dark');\n                document.documentElement.classList.add('light');\n            }\n        });\n    </script>\n    \n    <style>\n        ::-webkit-scrollbar { width: 6px; height: 6px; }\n        ::-webkit-scrollbar-track { background: transparent; }\n        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }\n        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }\n        .dark ::-webkit-scrollbar-thumb { background: #333; }\n        .dark ::-webkit-scrollbar-thumb:hover { background: #444; }\n        \n        .logo-spinner {\n            width: 48px;\n            height: 48px;\n            border-radius: 50%;\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .logo-spinner::before {\n            content: '';\n            position: absolute;\n            inset: 0;\n            border-radius: 50%;\n            padding: 3px;\n            background: linear-gradient(135deg, #137fec, #10b981, #f59e0b, #ef4444, #8b5cf6, #137fec);\n            background-size: 300% 300%;\n            animation: gradient-rotate 3s ease infinite;\n            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n            -webkit-mask-composite: xor;\n            mask-composite: exclude;\n        }\n        \n        @keyframes gradient-rotate {\n            0% { background-position: 0% 50%; }\n            50% { background-position: 100% 50%; }\n            100% { background-position: 0% 50%; }\n        }\n        \n        .logo-inner {\n            width: 42px;\n            height: 42px;\n            border-radius: 50%;\n            background: white;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            z-index: 1;\n        }\n        \n        .dark .logo-inner {\n            background: #0a0a0a;\n        }\n        \n        .logo-text-grupo {\n            font-weight: 700;\n            font-size: 10px;\n            color: #64748b;\n            letter-spacing: 0.3px;\n            text-transform: uppercase;\n            line-height: 1.2;\n        }\n        \n        .dark .logo-text-grupo {\n            color: #94a3b8;\n        }\n        \n        .logo-text-om {\n            font-weight: 700;\n            font-size: 10px;\n            color: #64748b;\n            letter-spacing: 0.3px;\n            line-height: 1.2;\n            text-transform: lowercase;\n        }\n        \n        .dark .logo-text-om {\n            color: #94a3b8;\n        }\n        \n        .rainbow-bar {\n            height: 3px;\n            background: linear-gradient(90deg, #137fec, #10b981, #f59e0b, #ef4444, #8b5cf6);\n            background-size: 200% 100%;\n            animation: gradient-shift 8s ease infinite;\n        }\n        \n        @keyframes gradient-shift {\n            0%, 100% { background-position: 0% 50%; }\n            50% { background-position: 100% 50%; }\n        }\n        \n        .stat-card {\n            transition: all 0.3s ease;\n        }\n        .stat-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px -5px rgba(19, 127, 236, 0.1);\n        }\n        .dark .stat-card:hover {\n            box-shadow: 0 8px 25px -5px rgba(19, 127, 236, 0.15);\n        }\n        \n        .table-row {\n            transition: background-color 0.2s ease;\n        }\n        \n        .dark .border-gray-700 {\n            border-color: #1a1a1a !important;\n        }\n        \n        @media print {\n            @page { size: A4; margin: 10mm; }\n            html, body { \n                background-color: white !important; \n                color: black !important; \n                -webkit-print-color-adjust: exact; \n            }\n            .rainbow-bar, .no-print, header button { display: none !important; }\n            .stat-card, .chart-card { \n                background: white !important; \n                border: 1px solid #ccc !important; \n                color: black !important; \n                box-shadow: none !important; \n                break-inside: avoid;\n            }\n            h1, h2, h3, span, p { color: black !important; }\n            .text-text-secondary { color: #444 !important; }\n            table { font-size: 9px; }\n            th { border-bottom: 2px solid #000; }\n            td { border-bottom: 1px solid #eee; }\n        }\n        \n        @keyframes pulse-ring {\n            0% { transform: scale(0.8); opacity: 1; }\n            100% { transform: scale(2); opacity: 0; }\n        }\n        .pulse-ring::before {\n            content: '';\n            position: absolute;\n            inset: 0;\n            border-radius: 50%;\n            background: currentColor;\n            animation: pulse-ring 1.5s ease-out infinite;\n        }\n    </style>\n</head>\n\n<body class=\"bg-background-light dark:bg-background-dark font-display text-text-main antialiased min-h-screen flex flex-col overflow-x-hidden\">\n    \n    <div class=\"rainbow-bar fixed top-0 left-0 right-0 z-50\"></div>\n    \n    <header class=\"bg-white dark:bg-card-dark border-b border-border-light dark:border-gray-700 sticky top-[3px] z-30\">\n        <div class=\"max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex items-center justify-between h-16\">\n                <div class=\"flex items-center gap-6\">\n                    <div class=\"flex items-center gap-3\">\n                        <div class=\"logo-spinner\">\n                            <div class=\"logo-inner\">\n                                <span class=\"logo-text-grupo\">Grupo</span>\n                                <span class=\"logo-text-om\">om</span>\n                            </div>\n                        </div>\n                        <div>\n                            <h1 class=\"text-lg font-bold tracking-tight text-text-main dark:text-gray-100\">Painel de Checking</h1>\n                            <p class=\"text-[10px] font-mono text-text-secondary dark:text-gray-500 uppercase tracking-wider\">Ecossistema de comunicação • Operações</p>\n                        </div>\n                    </div>\n                    \n                    <div class=\"h-6 w-px bg-border-light dark:bg-gray-800 hidden md:block\"></div>\n                    \n                    <nav class=\"hidden md:flex items-center gap-6\">\n                        <a class=\"text-sm font-medium text-primary border-b-2 border-primary h-16 flex items-center px-1\" href=\"#\">Dashboard</a>\n                    </nav>\n                </div>\n                \n                <div class=\"flex items-center gap-3\">\n                    <div class=\"hidden sm:flex items-center gap-2 px-3 py-1.5 bg-green-50 dark:bg-green-900/20 rounded-full\">\n                        <div class=\"relative w-2 h-2\">\n                            <div class=\"absolute inset-0 bg-green-500 rounded-full pulse-ring\"></div>\n                            <div class=\"relative w-2 h-2 bg-green-500 rounded-full\"></div>\n                        </div>\n                        <span class=\"text-xs font-medium text-green-700 dark:text-green-400\">Ao vivo</span>\n                    </div>\n                    \n                    <div class=\"relative hidden lg:block w-64\">\n                        <span class=\"absolute inset-y-0 left-0 flex items-center pl-3 text-text-secondary dark:text-gray-400\">\n                            <span class=\"material-symbols-outlined text-[20px]\">search</span>\n                        </span>\n                        <input id=\"globalSearch\" class=\"w-full pl-10 pr-4 py-2 bg-background-light dark:bg-black dark:text-gray-200 dark:border-gray-800 border border-border-light rounded-lg text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none placeholder:text-text-secondary/70 transition-all\" placeholder=\"Buscar cliente, PI...\" type=\"text\"/>\n                    </div>\n                    \n                    <button class=\"relative p-2.5 text-text-secondary dark:text-gray-400 hover:text-primary hover:bg-primary/5 rounded-lg transition-all\" onclick=\"toggleDarkMode()\" title=\"Alternar tema\">\n                        <span class=\"material-symbols-outlined dark:hidden\">light_mode</span>\n                        <span class=\"material-symbols-outlined hidden dark:block\">dark_mode</span>\n                    </button>\n                    \n                    <button onclick=\"window.print()\" class=\"flex items-center gap-2 bg-primary text-white hover:bg-primary-dark px-4 py-2.5 rounded-lg text-sm font-bold transition-colors shadow-sm shadow-primary/20 no-print\">\n                        <span class=\"material-symbols-outlined text-[18px]\">download</span>\n                        <span class=\"hidden sm:inline\">Exportar</span>\n                    </button>\n                    \n                    <button onclick=\"window.location.reload()\" class=\"p-2.5 text-text-secondary dark:text-gray-400 hover:text-primary hover:bg-primary/5 rounded-lg transition-all no-print\" title=\"Atualizar\">\n                        <span class=\"material-symbols-outlined\">refresh</span>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </header>\n    \n    <main class=\"flex-1 w-full max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        \n        <div class=\"flex flex-col md:flex-row md:items-end justify-between gap-4 mb-8\">\n            <div>\n                <h2 class=\"text-2xl font-black tracking-tight text-text-main dark:text-gray-100 mb-1\">Visão Geral de Operações</h2>\n                <p class=\"text-text-secondary dark:text-gray-400 text-sm\">Monitoramento em tempo real • Atualizado em ${dashboardData.metadata.atualizadoEm}</p>\n            </div>\n            <div class=\"flex items-center gap-3 no-print\">\n                <button id=\"headerPeriodBtn\" class=\"flex items-center gap-2 bg-white dark:bg-card-dark border border-border-light dark:border-gray-800 text-text-secondary dark:text-gray-300 hover:text-text-main dark:hover:text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm\">\n                    <span class=\"material-symbols-outlined text-[18px]\">calendar_today</span>\n                    <span id=\"headerPeriodText\">Todo o Período</span>\n                </button>\n            </div>\n        </div>\n        \n        <div class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n            \n            <div class=\"stat-card bg-white dark:bg-card-dark p-5 rounded-xl border border-border-light dark:border-gray-800 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group\">\n                <div class=\"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity\">\n                    <span class=\"material-symbols-outlined text-6xl text-primary\">database</span>\n                </div>\n                <div class=\"flex justify-between items-start\">\n                    <p class=\"text-text-secondary dark:text-gray-400 text-sm font-medium\">Total Registros</p>\n                    <span class=\"bg-blue-100 dark:bg-blue-900/30 text-primary dark:text-blue-400 text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1\">\n                        <span class=\"material-symbols-outlined text-[14px]\">database</span>\n                        <span id=\"kpiPeriod1\">Total</span>\n                    </span>\n                </div>\n                <div>\n                    <p class=\"text-3xl font-bold text-text-main dark:text-gray-100 tracking-tight font-mono\">${dashboardData.metricas.total.toLocaleString('pt-BR')}</p>\n                    <p class=\"text-xs text-text-secondary dark:text-gray-400 mt-1\">Média: ${dashboardData.metricas.mediaMovel}/dia</p>\n                </div>\n            </div>\n            \n            <div class=\"stat-card bg-white dark:bg-card-dark p-5 rounded-xl border border-border-light dark:border-gray-800 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group\">\n                <div class=\"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity\">\n                    <span class=\"material-symbols-outlined text-6xl text-success\">check_circle</span>\n                </div>\n                <div class=\"flex justify-between items-start\">\n                    <p class=\"text-text-secondary dark:text-gray-400 text-sm font-medium\">Taxa de Sucesso</p>\n                    <span class=\"bg-green-100 dark:bg-green-900/30 text-success dark:text-green-400 text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1\">\n                        <span class=\"material-symbols-outlined text-[14px]\">trending_up</span>\n                        ${dashboardData.metricas.taxaSucesso}%\n                    </span>\n                </div>\n                <div>\n                    <p class=\"text-3xl font-bold text-text-main dark:text-gray-100 tracking-tight font-mono\">${dashboardData.metricas.enviados.toLocaleString('pt-BR')}</p>\n                    <p class=\"text-xs text-text-secondary dark:text-gray-400 mt-1\">Envios confirmados</p>\n                </div>\n            </div>\n            \n            <div class=\"stat-card bg-white dark:bg-card-dark p-5 rounded-xl border border-border-light dark:border-gray-800 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group\">\n                <div class=\"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity\">\n                    <span class=\"material-symbols-outlined text-6xl text-error\">error</span>\n                </div>\n                <div class=\"flex justify-between items-start\">\n                    <p class=\"text-text-secondary dark:text-gray-400 text-sm font-medium\">Falhas</p>\n                    <span class=\"bg-red-100 dark:bg-red-900/30 text-error dark:text-red-400 text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1\">\n                        <span class=\"material-symbols-outlined text-[14px]\">warning</span>\n                        Atenção\n                    </span>\n                </div>\n                <div>\n                    <p class=\"text-3xl font-bold text-text-main dark:text-gray-100 tracking-tight font-mono\">${dashboardData.metricas.erros}</p>\n                    <p class=\"text-xs text-text-secondary dark:text-gray-400 mt-1\">Requer verificação</p>\n                </div>\n            </div>\n            \n            <div class=\"stat-card bg-white dark:bg-card-dark p-5 rounded-xl border border-border-light dark:border-gray-800 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group\">\n                <div class=\"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity\">\n                    <span class=\"material-symbols-outlined text-6xl text-warning\">schedule</span>\n                </div>\n                <div class=\"flex justify-between items-start\">\n                    <p class=\"text-text-secondary dark:text-gray-400 text-sm font-medium\">Hoje</p>\n                    <span class=\"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1\">\n                        <span class=\"material-symbols-outlined text-[14px]\">today</span>\n                        Live\n                    </span>\n                </div>\n                <div>\n                    <p class=\"text-3xl font-bold text-text-main dark:text-gray-100 tracking-tight font-mono\">${dashboardData.metricas.checkingsHoje}</p>\n                    <p class=\"text-xs text-text-secondary dark:text-gray-400 mt-1\">Checkings realizados</p>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\n            \n            <div class=\"chart-card bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-gray-800 shadow-sm p-6 lg:col-span-2 flex flex-col\">\n                <div class=\"flex items-center justify-between mb-6\">\n                    <div>\n                        <h3 class=\"text-base font-bold text-text-main dark:text-gray-100\">Fluxo de Envios</h3>\n                        <p class=\"text-xs text-text-secondary dark:text-gray-400\">Volume por cliente nos últimos <span id=\"chartPeriodLabel\">${historyDays}</span> dias</p>\n                    </div>\n                    <div class=\"flex items-center gap-1 bg-background-light dark:bg-black rounded-lg p-1 no-print\">\n                        <button id=\"btnAll\" class=\"chart-period-btn px-3 py-1.5 rounded-md text-xs font-semibold bg-white dark:bg-card-dark text-primary shadow-sm transition-all\" data-days=\"${historyDays}\">Todos</button>\n                        <button id=\"btn30d\" class=\"chart-period-btn px-3 py-1.5 rounded-md text-xs font-medium text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200 transition-all\" data-days=\"30\">30d</button>\n                        <button id=\"btn7d\" class=\"chart-period-btn px-3 py-1.5 rounded-md text-xs font-medium text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200 transition-all\" data-days=\"7\">7d</button>\n                    </div>\n                </div>\n                <div class=\"flex-1 min-h-[280px] w-full relative\">\n                    <canvas id=\"areaChart\"></canvas>\n                </div>\n            </div>\n            \n            <div class=\"chart-card bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-gray-800 shadow-sm p-6 flex flex-col\">\n                <h3 class=\"text-base font-bold text-text-main dark:text-gray-100 mb-1\">Top Performance</h3>\n                <p class=\"text-xs text-text-secondary dark:text-gray-400 mb-4\">Volume por Cliente (Top 6)</p>\n                <div class=\"flex-1 min-h-[240px] w-full relative\">\n                    <canvas id=\"radarChart\"></canvas>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"flex flex-col gap-4\">\n            <h3 class=\"text-xl font-bold text-text-main dark:text-gray-100 px-1\">Logs de Operações Recentes</h3>\n            \n            <div class=\"bg-white dark:bg-card-dark border border-border-light dark:border-gray-800 rounded-xl shadow-sm overflow-hidden flex flex-col\">\n                \n                <div class=\"p-4 border-b border-border-light dark:border-gray-800 flex flex-col sm:flex-row gap-4 justify-between items-center bg-gray-50/50 dark:bg-black no-print\">\n                    <div class=\"flex gap-2 w-full sm:w-auto\">\n                        <div class=\"relative flex-1 sm:w-64\">\n                            <span class=\"absolute inset-y-0 left-0 flex items-center pl-3 text-text-secondary dark:text-gray-400\">\n                                <span class=\"material-symbols-outlined text-[18px]\">search</span>\n                            </span>\n                            <input id=\"tableFilter\" class=\"w-full pl-9 pr-4 py-2 bg-white dark:bg-card-dark dark:text-gray-200 border border-border-light dark:border-gray-700 rounded-lg text-sm focus:ring-1 focus:ring-primary focus:border-primary outline-none transition-shadow\" placeholder=\"Filtrar logs...\" type=\"text\"/>\n                        </div>\n                    </div>\n                    <div class=\"flex p-1 bg-border-light/30 dark:bg-gray-900 rounded-lg\">\n                        <button class=\"filter-btn active px-3 py-1.5 rounded-md text-xs font-bold bg-white dark:bg-black text-primary shadow-sm\" data-filter=\"all\">Todos</button>\n                        <button class=\"filter-btn px-3 py-1.5 rounded-md text-xs font-medium text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200 hover:bg-white/50 dark:hover:bg-gray-800 transition-all\" data-filter=\"sucesso\">Sucesso</button>\n                        <button class=\"filter-btn px-3 py-1.5 rounded-md text-xs font-medium text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200 hover:bg-white/50 dark:hover:bg-gray-800 transition-all\" data-filter=\"erro\">Erros</button>\n                        <button class=\"filter-btn px-3 py-1.5 rounded-md text-xs font-medium text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200 hover:bg-white/50 dark:hover:bg-gray-800 transition-all\" data-filter=\"pendente\">Pendente</button>\n                    </div>\n                </div>\n                \n                <div class=\"overflow-x-auto\">\n                    <table class=\"w-full text-left border-collapse\">\n                        <thead>\n                            <tr class=\"bg-gray-50 dark:bg-black border-b border-border-light dark:border-gray-800 text-xs uppercase tracking-wider text-text-secondary dark:text-gray-400 font-semibold\">\n                                <th class=\"px-6 py-3\">Data/Hora</th>\n                                <th class=\"px-6 py-3\">Cliente</th>\n                                <th class=\"px-6 py-3\">PI</th>\n                                <th class=\"px-6 py-3\">Veículo</th>\n                                <th class=\"px-6 py-3 text-center\">Pasta</th>\n                                <th class=\"px-6 py-3 text-right\">Status</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"logsTableBody\" class=\"divide-y divide-border-light dark:divide-gray-800 text-sm text-text-main dark:text-gray-200\">\n                        </tbody>\n                    </table>\n                </div>\n                \n                <div class=\"px-6 py-4 border-t border-border-light dark:border-gray-800 flex items-center justify-between bg-gray-50/50 dark:bg-black\">\n                    <p class=\"text-xs text-text-secondary dark:text-gray-400\">\n                        Mostrando <span id=\"showingCount\" class=\"font-bold text-text-main dark:text-gray-200\">0</span> de <span id=\"totalCount\" class=\"font-bold text-text-main dark:text-gray-200\">0</span> resultados\n                    </p>\n                    <div class=\"flex gap-2 no-print\">\n                        <button id=\"prevPage\" class=\"p-1.5 rounded border border-border-light dark:border-gray-700 bg-white dark:bg-card-dark text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200 disabled:opacity-50\">\n                            <span class=\"material-symbols-outlined text-[18px]\">chevron_left</span>\n                        </button>\n                        <span id=\"pageInfo\" class=\"px-3 py-1.5 rounded border border-primary bg-primary text-white text-xs font-bold\">1</span>\n                        <button id=\"nextPage\" class=\"p-1.5 rounded border border-border-light dark:border-gray-700 bg-white dark:bg-card-dark text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200\">\n                            <span class=\"material-symbols-outlined text-[18px]\">chevron_right</span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </main>\n    \n    <footer class=\"border-t border-border-light dark:border-gray-800 py-4 mt-auto\">\n        <div class=\"max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8\">\n            <p class=\"text-center text-xs text-text-secondary dark:text-gray-500 font-mono\">\n                © 2026 Ecossistema de comunicação • Painel de Checking v2.1\n            </p>\n        </div>\n    </footer>\n    \n    <div class=\"rainbow-bar fixed bottom-0 left-0 right-0 z-50 opacity-50\"></div>\n    \n    <script>\n        const DATA = ${JSON.stringify(dashboardData)};\n        const MAX_DAYS = ${historyDays};\n        \n        let areaChartInstance = null;\n        let radarChartInstance = null;\n        \n        let currentFilter = 'all';\n        let searchTerm = '';\n        let currentPage = 1;\n        const itemsPerPage = 15;\n        let currentPeriod = MAX_DAYS;\n        \n        function isDarkMode() {\n            return document.documentElement.classList.contains('dark');\n        }\n        \n        function getChartColors() {\n            const dark = isDarkMode();\n            return {\n                grid: dark ? 'rgba(100, 116, 139, 0.25)' : 'rgba(0, 0, 0, 0.06)',\n                text: dark ? '#9ca3af' : '#64748b',\n                background: dark ? '#0a0a0a' : '#ffffff'\n            };\n        }\n        \n        const VIBRANT_COLORS = [\n            '#3b82f6', '#22c55e', '#f59e0b', '#ef4444', '#a855f7',\n            '#ec4899', '#06b6d4', '#f97316', '#14b8a6', '#8b5cf6',\n            '#eab308', '#10b981', '#6366f1', '#f43f5e', '#0ea5e9',\n        ];\n        \n        function renderAreaChart() {\n            const canvas = document.getElementById('areaChart');\n            if (!canvas) return;\n            \n            const ctx = canvas.getContext('2d');\n            const colors = getChartColors();\n            \n            if (areaChartInstance) {\n                areaChartInstance.destroy();\n            }\n            \n            const totalLabels = DATA.graficos.timeline.labels.length;\n            const startIndex = currentPeriod >= totalLabels ? 0 : Math.max(0, totalLabels - currentPeriod);\n            const filteredLabels = DATA.graficos.timeline.labels.slice(startIndex);\n            \n            const datasets = DATA.graficos.timeline.datasets.map((ds, index) => {\n                const color = VIBRANT_COLORS[index % VIBRANT_COLORS.length];\n                const gradient = ctx.createLinearGradient(0, 0, 0, 280);\n                if (isDarkMode()) {\n                    gradient.addColorStop(0, color + 'B3');\n                    gradient.addColorStop(0.5, color + '66');\n                    gradient.addColorStop(1, color + '0D');\n                } else {\n                    gradient.addColorStop(0, color + '99');\n                    gradient.addColorStop(0.5, color + '4D');\n                    gradient.addColorStop(1, color + '00');\n                }\n                \n                return {\n                    label: ds.label,\n                    data: ds.data.slice(startIndex),\n                    borderColor: color,\n                    backgroundColor: gradient,\n                    borderWidth: 2.5,\n                    tension: 0.4,\n                    fill: true,\n                    pointRadius: 0,\n                    pointHoverRadius: 6,\n                    pointHoverBackgroundColor: isDarkMode() ? '#fff' : color,\n                    pointHoverBorderColor: color,\n                    pointHoverBorderWidth: 2\n                };\n            });\n            \n            areaChartInstance = new Chart(ctx, {\n                type: 'line',\n                data: {\n                    labels: filteredLabels,\n                    datasets: datasets\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    interaction: {\n                        mode: 'index',\n                        intersect: false\n                    },\n                    plugins: {\n                        legend: {\n                            display: false\n                        },\n                        tooltip: {\n                            backgroundColor: isDarkMode() ? 'rgba(0,0,0,0.95)' : '#fff',\n                            titleColor: isDarkMode() ? '#fff' : '#000',\n                            bodyColor: isDarkMode() ? '#ccc' : '#333',\n                            borderColor: isDarkMode() ? 'rgba(255,255,255,0.1)' : '#e2e8f0',\n                            borderWidth: 1,\n                            padding: 12,\n                            displayColors: true,\n                            callbacks: {\n                                label: (ctx) => ' ' + ctx.dataset.label + ': ' + ctx.raw\n                            }\n                        }\n                    },\n                    scales: {\n                        x: {\n                            grid: { \n                                display: false \n                            },\n                            ticks: { \n                                color: colors.text, \n                                maxTicksLimit: currentPeriod === 7 ? 7 : 12,\n                                font: { size: 10 }\n                            }\n                        },\n                        y: {\n                            grid: { \n                                color: colors.grid,\n                                lineWidth: 1\n                            },\n                            border: { display: false },\n                            ticks: { \n                                color: colors.text,\n                                font: { size: 10 }\n                            },\n                            beginAtZero: true\n                        }\n                    }\n                }\n            });\n        }\n        \n        function renderRadarChart() {\n            const canvas = document.getElementById('radarChart');\n            if (!canvas) return;\n            \n            const ctx = canvas.getContext('2d');\n            const dark = isDarkMode();\n            \n            if (radarChartInstance) {\n                radarChartInstance.destroy();\n            }\n            \n            // Abreviar labels longos\n            const abreviateLabel = (label) => {\n                if (!label) return '';\n                const words = label.split(' ');\n                if (words.length > 2) {\n                    return words.slice(0, 2).join(' ') + '...';\n                }\n                return label.length > 15 ? label.substring(0, 15) + '...' : label;\n            };\n            \n            const labels = DATA.graficos.radar.labels.map(abreviateLabel);\n            \n            radarChartInstance = new Chart(ctx, {\n                type: 'radar',\n                data: {\n                    labels: labels,\n                    datasets: [{\n                        label: 'Volume',\n                        data: DATA.graficos.radar.data,\n                        backgroundColor: dark ? 'rgba(59, 130, 246, 0.5)' : 'rgba(19, 127, 236, 0.4)',\n                        borderColor: dark ? '#3b82f6' : '#137fec',\n                        borderWidth: 3,\n                        pointRadius: 4,\n                        pointBackgroundColor: dark ? '#fff' : '#137fec',\n                        pointBorderColor: dark ? '#3b82f6' : '#137fec',\n                        pointBorderWidth: 2,\n                        pointHoverRadius: 6,\n                        pointHoverBackgroundColor: '#22c55e',\n                        pointHoverBorderColor: '#fff',\n                        pointHoverBorderWidth: 2\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: { display: false },\n                        tooltip: {\n                            backgroundColor: dark ? 'rgba(0,0,0,0.9)' : 'rgba(255,255,255,0.95)',\n                            titleColor: dark ? '#fff' : '#000',\n                            bodyColor: dark ? '#3b82f6' : '#137fec',\n                            borderColor: dark ? '#3b82f6' : '#e2e8f0',\n                            borderWidth: 1,\n                            padding: 10,\n                            displayColors: true,\n                            callbacks: {\n                                title: (items) => DATA.graficos.radar.labels[items[0].dataIndex],\n                                label: (ctx) => ' ' + ctx.raw + ' envios'\n                            }\n                        }\n                    },\n                    scales: {\n                        r: {\n                            angleLines: { \n                                color: dark ? 'rgba(148, 163, 184, 0.3)' : 'rgba(203, 213, 225, 0.6)',\n                                lineWidth: 1\n                            },\n                            grid: { \n                                color: dark ? 'rgba(148, 163, 184, 0.25)' : 'rgba(203, 213, 225, 0.5)',\n                                lineWidth: 1\n                            },\n                            pointLabels: { \n                                color: dark ? '#cbd5e1' : '#64748b',\n                                font: { \n                                    size: 10,\n                                    weight: '600',\n                                    family: 'Inter'\n                                },\n                                padding: 15\n                            },\n                            ticks: { \n                                display: true,\n                                color: dark ? '#64748b' : '#94a3b8',\n                                backdropColor: 'transparent',\n                                font: { \n                                    size: 9,\n                                    family: 'JetBrains Mono'\n                                },\n                                stepSize: Math.ceil(Math.max(...DATA.graficos.radar.data) / 4)\n                            },\n                            suggestedMin: 0,\n                            suggestedMax: Math.ceil(Math.max(...DATA.graficos.radar.data) * 1.15)\n                        }\n                    }\n                }\n            });\n        }\n        \n        window.renderCharts = function() {\n            renderAreaChart();\n            renderRadarChart();\n        };\n        \n        function setPeriod(days) {\n            currentPeriod = days;\n            \n            const btnAll = document.getElementById('btnAll');\n            const btn30d = document.getElementById('btn30d');\n            const btn7d = document.getElementById('btn7d');\n            \n            const activeClass = 'chart-period-btn px-3 py-1.5 rounded-md text-xs font-semibold bg-white dark:bg-card-dark text-primary shadow-sm transition-all';\n            const inactiveClass = 'chart-period-btn px-3 py-1.5 rounded-md text-xs font-medium text-text-secondary dark:text-gray-400 hover:text-text-main dark:hover:text-gray-200 transition-all';\n            \n            btnAll.className = inactiveClass;\n            btn30d.className = inactiveClass;\n            btn7d.className = inactiveClass;\n            \n            if (days === MAX_DAYS) {\n                btnAll.className = activeClass;\n                document.getElementById('headerPeriodText').textContent = 'Todo o Período';\n            } else if (days === 30) {\n                btn30d.className = activeClass;\n                document.getElementById('headerPeriodText').textContent = 'Últimos 30 dias';\n            } else {\n                btn7d.className = activeClass;\n                document.getElementById('headerPeriodText').textContent = 'Últimos 7 dias';\n            }\n            \n            document.getElementById('chartPeriodLabel').textContent = days;\n            \n            renderAreaChart();\n        }\n        \n        function getStatusBadge(status) {\n            const s = (status || '').toLowerCase();\n            let classes = 'bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700';\n            \n            if (s.includes('sucesso') || s.includes('enviado')) {\n                classes = 'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/40 dark:text-green-300 dark:border-green-800';\n            } else if (s.includes('erro') || s.includes('falha')) {\n                classes = 'bg-red-100 text-red-700 border-red-200 dark:bg-red-900/40 dark:text-red-300 dark:border-red-800';\n            } else if (s.includes('pendente')) {\n                classes = 'bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/40 dark:text-amber-300 dark:border-amber-800';\n            }\n            \n            return '<span class=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border ' + classes + '\">' +\n                   '<span class=\"w-1.5 h-1.5 rounded-full bg-current opacity-70\"></span>' +\n                   status + '</span>';\n        }\n        \n        function getDriveLink(link) {\n            if (link && link !== '#' && link !== '') {\n                return '<a href=\"' + link + '\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-primary hover:bg-primary/10 text-xs font-medium transition-colors\" title=\"Abrir pasta no Drive\">' +\n                        '<span class=\"material-symbols-outlined text-[18px]\">folder_open</span>' +\n                        '<span>Abrir</span></a>';\n            }\n            return '<span class=\"text-text-secondary dark:text-gray-500 text-xs\">-</span>';\n        }\n        \n        function getFilteredLogs() {\n            return DATA.tabelas.logs.filter(log => {\n                if (currentFilter !== 'all') {\n                    const s = (log.status || '').toLowerCase();\n                    if (currentFilter === 'sucesso' && !s.includes('sucesso') && !s.includes('enviado')) return false;\n                    if (currentFilter === 'erro' && !s.includes('erro') && !s.includes('falha')) return false;\n                    if (currentFilter === 'pendente' && !s.includes('pendente')) return false;\n                }\n                \n                if (searchTerm) {\n                    const term = searchTerm.toLowerCase();\n                    const searchable = (log.cliente + ' ' + log.pi + ' ' + log.veiculo).toLowerCase();\n                    if (!searchable.includes(term)) return false;\n                }\n                \n                return true;\n            });\n        }\n        \n        function renderTable() {\n            const tbody = document.getElementById('logsTableBody');\n            const filtered = getFilteredLogs();\n            const totalPages = Math.ceil(filtered.length / itemsPerPage) || 1;\n            \n            if (currentPage > totalPages) currentPage = Math.max(1, totalPages);\n            \n            const start = (currentPage - 1) * itemsPerPage;\n            const end = start + itemsPerPage;\n            const pageItems = filtered.slice(start, end);\n            \n            document.getElementById('showingCount').textContent = pageItems.length;\n            document.getElementById('totalCount').textContent = filtered.length;\n            document.getElementById('pageInfo').textContent = currentPage + '/' + totalPages;\n            \n            document.getElementById('prevPage').disabled = currentPage <= 1;\n            document.getElementById('nextPage').disabled = currentPage >= totalPages;\n            \n            tbody.innerHTML = pageItems.map(log => \n                '<tr class=\"table-row hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors\">' +\n                    '<td class=\"px-6 py-3 font-mono text-xs text-text-secondary dark:text-gray-400\">' + log.timestamp + '</td>' +\n                    '<td class=\"px-6 py-3 font-medium\">' + log.cliente + '</td>' +\n                    '<td class=\"px-6 py-3 font-mono text-xs\">' + log.pi + '</td>' +\n                    '<td class=\"px-6 py-3 text-text-secondary dark:text-gray-400 truncate max-w-[200px]\">' + log.veiculo + '</td>' +\n                    '<td class=\"px-6 py-3 text-center\">' + getDriveLink(log.driveLink) + '</td>' +\n                    '<td class=\"px-6 py-3 text-right\">' + getStatusBadge(log.status) + '</td>' +\n                '</tr>'\n            ).join('');\n        }\n        \n        document.addEventListener('DOMContentLoaded', function() {\n            // Pequeno delay para garantir que os canvas estejam prontos\n            setTimeout(() => {\n                renderCharts();\n            }, 100);\n            \n            renderTable();\n            \n            document.getElementById('btnAll').addEventListener('click', () => setPeriod(MAX_DAYS));\n            document.getElementById('btn30d').addEventListener('click', () => setPeriod(30));\n            document.getElementById('btn7d').addEventListener('click', () => setPeriod(7));\n            \n            document.querySelectorAll('.filter-btn').forEach(btn => {\n                btn.addEventListener('click', function() {\n                    document.querySelectorAll('.filter-btn').forEach(b => {\n                        b.classList.remove('active', 'bg-white', 'dark:bg-black', 'text-primary', 'shadow-sm', 'font-bold');\n                        b.classList.add('font-medium');\n                    });\n                    this.classList.add('active', 'bg-white', 'dark:bg-black', 'text-primary', 'shadow-sm', 'font-bold');\n                    this.classList.remove('font-medium');\n                    currentFilter = this.dataset.filter;\n                    currentPage = 1;\n                    renderTable();\n                });\n            });\n            \n            document.getElementById('tableFilter').addEventListener('input', function() {\n                searchTerm = this.value;\n                currentPage = 1;\n                renderTable();\n            });\n            \n            document.getElementById('globalSearch').addEventListener('input', function() {\n                searchTerm = this.value;\n                document.getElementById('tableFilter').value = this.value;\n                currentPage = 1;\n                renderTable();\n            });\n            \n            document.getElementById('prevPage').addEventListener('click', function() {\n                if (currentPage > 1) {\n                    currentPage--;\n                    renderTable();\n                }\n            });\n            \n            document.getElementById('nextPage').addEventListener('click', function() {\n                const filtered = getFilteredLogs();\n                const totalPages = Math.ceil(filtered.length / itemsPerPage);\n                if (currentPage < totalPages) {\n                    currentPage++;\n                    renderTable();\n                }\n            });\n        });\n        \n        // Garantir renderização dos gráficos após carregamento completo\n        window.addEventListener('load', function() {\n            setTimeout(() => {\n                if (areaChartInstance === null || radarChartInstance === null) {\n                    renderCharts();\n                }\n            }, 150);\n        });\n    </script>\n</body>\n</html>\n`;\n\nreturn [{ json: { html } }];"
      },
      "id": "d4e3f978-bd68-42f6-b2d0-822a25e0fd1e",
      "name": "Gerar HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5360,
        -2368
      ]
    },
    {
      "parameters": {
        "content": "## PAINEL CHEKING - teste\n",
        "height": 256,
        "width": 1184,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6112,
        -2432
      ],
      "typeVersion": 1,
      "id": "7dd6877c-2897-49cb-b154-1c484f498f32",
      "name": "Sticky Note25"
    }
  ],
  "pinData": {},
  "connections": {
    "Definir ID da Pasta Cliente2": {
      "main": [
        [
          {
            "node": "Criar Pasta PI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "É Busca de PI?": {
      "main": [
        [
          {
            "node": "Buscar PI no Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar Submissão",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar PI no Sheets": {
      "main": [
        [
          {
            "node": "Formatar Resposta PI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Resposta PI": {
      "main": [
        [
          {
            "node": "Responder JSON PI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Submissão": {
      "main": [
        [
          {
            "node": "Validação OK?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validação OK?": {
      "main": [
        [
          {
            "node": "Link do Driver",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Responder Erro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Link do Driver": {
      "main": [
        [
          {
            "node": "Preparar Log Link",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Buscar Pasta Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Log Link": {
      "main": [
        [
          {
            "node": "Unificar Fluxos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unificar Fluxos": {
      "main": [
        [
          {
            "node": "Registrar Log no Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Enviar E-mail Notificação",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Pasta Cliente": {
      "main": [
        [
          {
            "node": "Pasta Cliente Existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasta Cliente Existe?": {
      "main": [
        [
          {
            "node": "Definir ID da Pasta Cliente2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Criar Pasta Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Criar Pasta PI": {
      "main": [
        [
          {
            "node": "Separar Cada Arquivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Separar Cada Arquivo": {
      "main": [
        [
          {
            "node": "Upload Arquivo no Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Arquivo no Drive": {
      "main": [
        [
          {
            "node": "Aguardar Todos Uploads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aguardar Todos Uploads": {
      "main": [
        [
          {
            "node": "Preparar Log Binary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Log Binary": {
      "main": [
        [
          {
            "node": "Unificar Fluxos",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Criar Pasta Cliente": {
      "main": [
        [
          {
            "node": "Definir ID da Pasta Cliente2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar E-mail Notificação": {
      "main": [
        [
          {
            "node": "Enviar E-mail Notificação - Para o Fornecedor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar E-mail Notificação - Para o Fornecedor": {
      "main": [
        [
          {
            "node": "Responder Sucesso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook POST": {
      "main": [
        [
          {
            "node": "É Busca de PI?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets - Ler Dados": {
      "main": [
        [
          {
            "node": "Processar Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook - Painel Checking": {
      "main": [
        [
          {
            "node": "Google Sheets - Ler Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Dados": {
      "main": [
        [
          {
            "node": "Gerar HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gerar HTML": {
      "main": [
        [
          {
            "node": "Responder Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "versionId": "eeb140ce-f4bb-4891-9565-821f383c2c02",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6b93d26d78f3422a2df7daf09364ceee25a1cd3223a663b1fe4533d415237602"
  },
  "id": "ohDsD6vHsI3zfeU6",
  "tags": [
    {
      "updatedAt": "2025-11-13T10:28:59.210Z",
      "createdAt": "2025-11-13T10:28:59.210Z",
      "id": "9MUPjQ9DCi0yaf3O",
      "name": "PROD"
    }
  ]
}